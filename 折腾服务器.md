# æœåŠ¡å™¨å›ºä»¶åŸºç¡€çŸ¥è¯†

æœåŠ¡å™¨éœ€è¦ä¸é—´æ–­çš„ç›‘æ§ç¡¬ä»¶è®¾å¤‡ï¼Œå“ªæ€•æœåŠ¡å™¨ç³»ç»Ÿæ¢æœºçŠ¶æ€æ¯”å¦‚ï¼š

- ç”µæºç®¡ç†æ¥å£ï¼šç›‘æ§/æ§åˆ¶ç”µå‹ã€é£æ‰‡ã€æ¸©åº¦ã€‚
- ä¸»æœºæ¡¥æ¥æ¥å£ï¼šKCS/BT/SMBusã€PCIeã€UARTï¼Œç”¨æ¥ä¸ä¸» CPU/èŠ¯ç‰‡ç»„äº¤æ¢ä¼ æ„Ÿå™¨æ•°æ®æˆ–å‘èµ·ç”µæºæ§åˆ¶ã€‚
- ç‹¬ç«‹ç½‘ç»œç«¯å£ï¼šIPMI/Redfish/SSH/Web è®¿é—®ã€‚
- è§†é¢‘æ•è·/é‡å®šå‘ï¼šå›¾å½¢æ ¸å¿ƒå¯æŠŠä¸»æœº VGA è¾“å‡ºé€šè¿‡ç½‘ç»œæä¾›è¿œç¨‹ KVMã€‚

  ## BMCç³»ç»Ÿä¸æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ

|   |   |   |
|---|---|---|
|å±‚çº§|BMC å›ºä»¶ï¼ˆä»¥ OpenBMC ä¸ºä¾‹ï¼‰|æœåŠ¡å™¨ä¸»æœºæ“ä½œç³»ç»Ÿï¼ˆå¦‚ Ubuntu Serverï¼‰|
|è¿è¡Œå¹³å°|BMC SoCï¼ˆç‹¬ç«‹ CPU + RAM + Flashï¼‰|x86/ARM æœåŠ¡å™¨ CPU + ç³»ç»Ÿå†…å­˜|
|å¯åŠ¨é“¾|Boot ROM â†’ U-Boot â†’ Linux Kernel â†’ rootfs|BIOS/UEFI â†’ å¼•å¯¼ç¨‹åº â†’ Linux Kernel â†’ rootfs|
|ä¸»è¦ä»»åŠ¡|ç›‘æ§ç¡¬ä»¶ã€è¿œç¨‹ç®¡ç†ã€ç”µæºæ§åˆ¶ã€KVMã€å›ºä»¶æ›´æ–°|è¿è¡Œç”¨æˆ·åº”ç”¨ã€æ–‡ä»¶ç³»ç»Ÿã€è°ƒåº¦ä»»åŠ¡ç­‰|
|æ¥å£æ ‡å‡†|IPMIã€Redfishã€Web UIã€DBus|POSIX APIã€ç½‘ç»œåè®®ã€ç³»ç»Ÿè°ƒç”¨|
|å®æ—¶æ€§/è´Ÿè½½|è½»é‡ç®¡ç†ï¼ŒI/O è¾ƒå°‘|é€šç”¨è®¡ç®—ï¼Œå¯é«˜è´Ÿè½½å¹¶å‘|

åŒºåˆ«å…³é”®ç‚¹ï¼š

- BMC æ˜¯â€œæ—è·¯â€ç³»ç»Ÿï¼Œå³ä½¿ä¸»æœºå…³æœºã€ç³»ç»Ÿå´©æºƒï¼Œå®ƒä»å¯ç‹¬ç«‹è¿è¡Œã€‚
- ä¸»æœº OSï¼ˆUbuntu ç­‰ï¼‰ä»…åœ¨æœåŠ¡å™¨æ­£å¸¸ä¸Šç”µæ—¶å·¥ä½œï¼Œæ— æ³•ç›´æ¥å–ä»£ BMC çš„å¸¦å¤–ç®¡ç†åŠŸèƒ½ã€‚

å¾ˆä»¤äººæƒŠè®¶çš„æ˜¯ï¼
- OpenBMC æ˜¯åŸºäº åµŒå…¥å¼ Linux çš„å®Œæ•´å‘è¡Œç‰ˆï¼Œä½¿ç”¨ Yocto/BitBake æ„å»ºï¼Œæ ¸å¿ƒæ˜¯æ ‡å‡† Linux kernel + systemd + D-Busã€‚
- è¿™å¸¦æ¥ä¸°å¯Œçš„é©±åŠ¨æ”¯æŒã€åŒ…ç®¡ç†å’Œç½‘ç»œæ ˆï¼Œè€Œä¸æ˜¯è½»é‡ RTOSã€‚
- å½“ç„¶ï¼Œå‚å•†å¦‚æœæ„¿æ„ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ BMC å›ºä»¶ï¼ˆæ¯”å¦‚åŸºäº FreeRTOSã€VxWorksï¼‰ï¼Œä½† OpenBMC å®˜æ–¹é€‰æ‹© Linux ä»¥ä¾¿å¼€å‘å’Œç§»æ¤ï¼Œè€Œä¸”å¤§å¤šéƒ½æ˜¯ä»OpenBMCç§»æ¤è¿‡å»çš„ã€‚

è¿™æ„å‘³ç€ BMC è‡ªèº«å°±æ˜¯ä¸€ä¸ªéœ€è¦é©±åŠ¨çš„åµŒå…¥å¼ Linux ç³»ç»Ÿï¼Œè€Œä¸æ˜¯åªé ä¸»æœºé©±åŠ¨ã€‚

## [OpenBMC]([openBMC](https://github.com/openbmc/openbmc)ï¼Ÿ)åŸºæœ¬åŸç†

1. æ˜¯ä»€ä¹ˆï¼šOpenBMC æ˜¯ Linux åŸºç¡€çš„ BMC å›ºä»¶å‘è¡Œç‰ˆ/é¡¹ç›®ï¼ˆç”± Linux Foundation ä¸‹çš„ç¤¾åŒºç»´æŠ¤ï¼‰ï¼Œç›®æ ‡æ˜¯ä¸ºä¸åŒå‚å•†/å¹³å°æä¾›ç»Ÿä¸€ã€å¯å®šåˆ¶çš„å¼€æº BMC å®ç°ã€‚å®ƒç”¨ Yocto/BitBake æ„å»ºé•œåƒï¼Œè¿è¡Œ Linux + systemd + DBusï¼Œå¹¶æŠŠç¡¬ä»¶èµ„æºæ˜ å°„ä¸º DBus å¯¹è±¡ï¼Œå†é€šè¿‡æœåŠ¡ï¼ˆå¦‚ bmcwebï¼‰æŠŠè¿™äº›æ˜ å°„ä¸º Redfish ä¸ Web UIã€‚Â 
2. ä¸»è¦ç»„ä»¶ï¼ˆå…¸å‹ï¼‰ï¼š  
    

- Bootloaderï¼ˆé€šå¸¸æ˜¯ U-Bootï¼‰â†’ Linux kernel â†’ OpenBMC userspaceï¼ˆYocto æ„å»ºï¼‰ã€‚Â 
- phosphor- ç»„ä»¶*ï¼šçŠ¶æ€ç®¡ç†ã€loggingã€sensorã€SEL/äº‹ä»¶ç®¡ç†ç­‰ï¼ˆOpenBMC ç¤¾åŒºå¸¸è§æ¨¡å—ï¼‰ã€‚Â 
- bmcwebï¼šæŠŠ DBus å¯¹è±¡ç¿»è¯‘æˆ Redfish REST/JSON æ¥å£ï¼Œå¹¶æä¾› web UI / KVM / vMedia æ”¯æŒã€‚Â 
- å‘åå…¼å®¹ï¼šOpenBMC èƒ½æä¾› IPMI æ”¯æŒï¼ˆé€šè¿‡ DBus/IPMI æ¡¥æ¥æˆ–ç›´æ¥å®ç°ï¼‰ï¼ŒåŒæ—¶ä¸»æ¨ Redfishï¼ˆDMTF æ ‡å‡†ï¼‰ã€‚Â 



### OpenBMC å…¸å‹è½¯ä»¶æ ˆ

ç¡¬ä»¶ (BMC SoC + å¤–è®¾)
â””â”€ Linux å†…æ ¸ & è®¾å¤‡é©±åŠ¨
Â Â  â””â”€ systemd
Â  Â  Â  â””â”€ DBus å¯¹è±¡ (ä¼ æ„Ÿå™¨ã€ç”µæºã€æ—¥å¿—ã€ç½‘ç»œ)
Â Â  Â  Â  Â  â”œâ”€ phosphor-* æœåŠ¡ (ç”µæºæ§åˆ¶ã€æ—¥å¿—ã€IPMI)
Â Â  Â  Â  Â  â”œâ”€ bmcweb (æä¾› Redfish REST / Web UI)
Â Â  Â  Â  Â  â””â”€ ipmid (IPMI åè®®å®ˆæŠ¤è¿›ç¨‹)

- Redfishï¼šç°ä»£ REST/JSON ç®¡ç†æ¥å£ã€‚
- IPMIï¼šä¼ ç»Ÿå‘½ä»¤åè®®ï¼ˆå‘åå…¼å®¹ï¼‰ã€‚
- é€šè¿‡ DBus å®ç°ç¡¬ä»¶æŠ½è±¡ï¼Œå¼€å‘è€…å¯ç”¨ Python/C++ å†™ç®¡ç†æœåŠ¡è€Œä¸ç”¨ç›´æ¥ç¢°é©±åŠ¨ã€‚


## BMCä¸ä¸»æœº OS ç®¡ç†çš„è¾¹ç•Œ

- ä¸»æœº OS é©±åŠ¨ï¼šè´Ÿè´£ CPUã€ç£ç›˜ã€ç½‘å¡ç­‰ä¸ºä¸šåŠ¡æœåŠ¡çš„ç¡¬ä»¶ã€‚
- BMC é©±åŠ¨ï¼šåªå…³å¿ƒ BMC èŠ¯ç‰‡æœ¬èº«å’Œä¼ æ„Ÿå™¨ï¼Œå¹¶å¯é€šè¿‡ IPMI/Redfish å‘ä¸»æœºæˆ–è¿œç¨‹è¿ç»´äººå‘˜æ±‡æŠ¥ã€‚
- äº¤äº’ï¼šä¸»æœº OS å¯ä»¥ä½¿ç”¨ ipmitoolã€ipmi_si ç­‰é©±åŠ¨ä¸ BMC é€šè®¯ï¼Œå®ç°å¦‚ ipmitool chassis power cycle ç­‰å¸¦å¤–æ“ä½œï¼Œä½†ä¸¤å¥—å†…æ ¸å½¼æ­¤ç‹¬ç«‹ã€‚


- BMC = æœåŠ¡å™¨ä¸Šçš„ç‹¬ç«‹åµŒå…¥å¼è®¡ç®—æœºã€‚
- OpenBMC = è¿è¡Œåœ¨ BMC ä¸Šçš„åµŒå…¥å¼ Linux å‘è¡Œç‰ˆï¼Œä¸ä½¿ç”¨ FreeRTOSã€‚
- å®ƒéœ€è¦è‡ªå·±çš„Linux å†…æ ¸é©±åŠ¨ä¸æ¿çº§ä¼ æ„Ÿå™¨é©±åŠ¨ï¼Œå¹¶é€šè¿‡ DBus + IPMI/Redfish æš´éœ²åŠŸèƒ½ã€‚
- ä¸»æœº OSï¼ˆUbuntu ç­‰ï¼‰ä¸ BMC å®Œå…¨éš”ç¦»ï¼šå‰è€…è´Ÿè´£ä¸šåŠ¡è®¡ç®—ï¼Œåè€…è´Ÿè´£å¸¦å¤–ç®¡ç†ã€‚


## IPMIçš„åŸç†ä¸ç»„æˆ

1. ç›®æ ‡ï¼šåœ¨ä¸»æœºï¼ˆOS/BIOSï¼‰ä¸å¯ç”¨æˆ–å…³æœºçš„æƒ…å†µä¸‹ï¼Œæä¾›â€œå¸¦å¤–â€ï¼ˆout-of-bandï¼‰çš„ç›‘æ§ä¸ç®¡ç†èƒ½åŠ›ï¼ˆè¯»æ¸©åº¦/é£æ‰‡/ç”µå‹ã€æŸ¥çœ‹ç¡¬ä»¶æ—¥å¿—ã€è¿œç¨‹å¼€/å…³æœºã€è™šæ‹Ÿä»‹è´¨ã€ä¸²å£é‡å®šå‘ç­‰ï¼‰ã€‚Â 
2. æ ¸å¿ƒç»„æˆï¼š  
- BMC ç¡¬ä»¶ï¼šç‹¬ç«‹å¾®æ§åˆ¶å™¨/SoCï¼ˆæœ‰è‡ªå·±çš„ç½‘å£ã€é—ªå­˜ã€RAMã€ä¸²å£ç­‰ï¼‰ã€‚
- IPMI åè®®å±‚ï¼šå®šä¹‰äº† messagesã€sensor data recordsï¼ˆSDRï¼‰ã€system event logï¼ˆSELï¼‰ã€FRUï¼ˆField Replaceable Unitï¼‰inventoryã€KCS/SMBus/BT æ¥å£ã€Serial-over-LAN (SOL)ã€IPMI over LANï¼ˆRMCP+ï¼‰ç­‰ã€‚Â 
- å¸¸ç”¨å·¥å…·ï¼šipmitoolã€FreeIPMIã€OpenIPMI ç­‰ç”¨äºäº¤äº’ä¸è„šæœ¬åŒ–ç®¡ç†ã€‚Â 
å®‰å…¨æ³¨æ„ï¼šIPMI çš„å†å²ç‰ˆæœ¬å­˜åœ¨è®¾è®¡ä¸å®ç°ä¸Šçš„å¼±ç‚¹ï¼ˆæ˜æ–‡/ä¸å®‰å…¨çš„è®¤è¯ã€Cipher 0 ç­‰ï¼‰ï¼Œå› æ­¤ä¸è¦å°†ç®¡ç†å£ç›´æ¥æš´éœ²åˆ°å…¬ç½‘ï¼ŒåŠ¡å¿…éš”ç¦»ç®¡ç†ç½‘ç»œå¹¶åŠæ—¶å‡çº§å›ºä»¶ã€‚Â 

  
## Redfishç®€ä»‹
ç”± DMTFï¼ˆDistributed Management Task Forceï¼‰åˆ¶å®šï¼Œ2015 å¹´å‘å¸ƒã€‚ç›®æ ‡ï¼šå–ä»£ IPMIï¼ˆæ—©æœŸäºŒè¿›åˆ¶/ä¸“æœ‰å‘½ä»¤ï¼‰  
    
- ç»Ÿä¸€å¸¦å¤–ç®¡ç†æ¥å£
- é‡‡ç”¨ç°ä»£ Web æ ‡å‡†ï¼ˆHTTPs + REST + JSONï¼‰
- æ˜“æ‰©å±•ã€é¢å‘äº‘ä¸è‡ªåŠ¨åŒ–

### Redfishæ¶æ„
  
```mermaid
flowchart TB
    %% ==== Client ====
    subgraph ClientSide["å®¢æˆ·ç«¯ / è¿ç»´å·¥å…·"]
        A1["æµè§ˆå™¨ / WebUI"]
        A2["è‡ªåŠ¨åŒ–è„šæœ¬ (Ansible / python-redfish)"]
    end

    %% ==== Redfish Service ====
    subgraph RedfishSvc["Redfish æœåŠ¡ (é€šå¸¸è¿è¡Œåœ¨ BMC)"]
        B1["HTTPS Listener (TLS)"]
        B2["REST Engine"]
        B3["Schema / Model (JSON Schema & OData)"]
        B4["Event & Telemetry Engine"]
        B5["AuthN / AuthZ (Basic / Token / OAuth2)"]
    end

    %% ==== Platform ====
    subgraph PlatformHw["å¹³å°ç¡¬ä»¶ä¸å›ºä»¶"]
        C1["ä¼ æ„Ÿå™¨ / ç”µæº / é£æ‰‡"]
        C2["ä¸»æœº CPU / å†…å­˜ / å­˜å‚¨"]
        C3["å›ºä»¶æ¥å£ (é©±åŠ¨ / DBus / è®¾å¤‡æŠ½è±¡)"]
    end

    %% ==== Links ====
    ClientSide -->|HTTPS / REST / JSON| RedfishSvc
    RedfishSvc -->|é©±åŠ¨ / DBus| PlatformHw

    %% ==== Resources ====
    subgraph RedfishRes["Redfish ä¸»è¦èµ„æº"]
        R1["/Systems/{id} (ç”µæº/å¼•å¯¼/å¥åº·)"]
        R2["/Chassis/{id} (æ¸©åº¦/é£æ‰‡)"]
        R3["/Managers/{id} (BMC é…ç½®)"]
        R4["/AccountService (ç”¨æˆ·/è§’è‰²)"]
        R5["/EventService (äº‹ä»¶è®¢é˜…)"]
    end

    RedfishSvc --> RedfishRes
    R5 -->|äº‹ä»¶æ¨é€ HTTP POST| ClientSide
    R1 -->|Action: Reset / Power| ClientSide
```
- æœåŠ¡ç«¯ï¼šé€šå¸¸è¿è¡Œåœ¨ BMC ä¸Šï¼Œä¹Ÿå¯è¿è¡Œåœ¨æœºæ¶æ§åˆ¶å™¨ã€å­˜å‚¨é˜µåˆ—æˆ–è£¸æœºä¸»æœºã€‚
- å®¢æˆ·ç«¯ï¼šæµè§ˆå™¨ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€è¿ç»´å¹³å°ã€Ansibleã€Python SDKï¼ˆpython-redfishï¼‰ç­‰ã€‚

  
Redfish é‡‡ç”¨é¢å‘èµ„æºçš„ REST æ¨¡å‹ï¼Œæ¯ä¸ªèµ„æºæ˜¯ä¸€ä¸ª JSON å¯¹è±¡å¹¶æœ‰ URIï¼š

- æ ¹å…¥å£ï¼š/redfish/v1/
- å…³é”®èµ„æºç¤ºä¾‹ï¼š  
- Systems/{id}ï¼šä¸»æœºèŠ‚ç‚¹ã€ç”µæºçŠ¶æ€ã€å¼•å¯¼é¡ºåºã€è™šæ‹Ÿä»‹è´¨
- Chassis/{id}ï¼šæœºç®±ã€é£æ‰‡ã€æ¸©åº¦ä¼ æ„Ÿå™¨
- Managers/{id}ï¼šBMC è‡ªèº«ä¿¡æ¯ã€å›ºä»¶ã€ç½‘ç»œé…ç½®
- AccountServiceï¼šç”¨æˆ·å’Œè®¤è¯ç®¡ç†
- EventServiceã€TelemetryService ç­‰


#### Schema
- ä½¿ç”¨ JSON Schema å’Œ OData CSDL å®šä¹‰èµ„æºå±æ€§ä¸æ“ä½œã€‚
- å…è®¸å‚å•†æ‰©å±•ï¼šOEM èŠ‚ç‚¹ (Oem) ç”¨äºä¸“æœ‰å­—æ®µã€‚
  

#### RESTful API

- æ ‡å‡† HTTP æ–¹æ³•ï¼šGET/POST/PATCH/DELETE
- Content-Type: application/json
- å…¸å‹è¯·æ±‚ï¼š  
`GET /redfish/v1/Systems/1`

- è¿”å›ä¸»æœº CPUã€å†…å­˜ã€å¼•å¯¼ã€å¥åº·çŠ¶æ€ç­‰ JSON

**äº‹ä»¶ä¸è®¢é˜…** (Event Service)  

- å®¢æˆ·ç«¯å¯ POST è®¢é˜…ç›®æ ‡åˆ° /EventService/Subscriptionsã€‚
- æœåŠ¡ç«¯é€šè¿‡ HTTP POST å‘å®¢æˆ·ç«¯æ¨é€å¼‚æ­¥äº‹ä»¶ï¼ˆä¾‹å¦‚ç”µæºæ•…éšœã€æ¸©åº¦å‘Šè­¦ï¼‰ã€‚
    
ä»»åŠ¡ (Task Service)  

- å¯¹è€—æ—¶æ“ä½œï¼ˆå›ºä»¶æ›´æ–°ã€ç³»ç»Ÿé‡è£…ï¼‰è¿”å›ä¸€ä¸ª Task èµ„æºï¼Œå¯è½®è¯¢æˆ–è®¢é˜…å®ŒæˆçŠ¶æ€ã€‚ 
    
Action æœºåˆ¶  

- åœ¨ JSON ä¸­å®šä¹‰ "Actions" èŠ‚ç‚¹ï¼Œå¦‚ï¼š
```json
"Actions": {
  "#ComputerSystem.Reset": {
    "target": "/redfish/v1/Systems/1/Actions/ComputerSystem.Reset",
    "ResetType@Redfish.AllowableValues": ["On","ForceOff","GracefulRestart"]
  }
}
```
- å®¢æˆ·ç«¯ POST è¯·æ±‚åˆ° target å³å¯è§¦å‘é‡å¯ç­‰æ“ä½œã€‚

  
### ä¸ IPMI çš„æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§      | IPMI            | Redfish            |
| ------- | --------------- | ------------------ |
| åè®®æ ˆ     | äºŒè¿›åˆ¶æ¶ˆæ¯ï¼ŒRMCP+     | HTTPS/REST/JSON    |
| æ•°æ®æ¨¡å‹    | å›ºå®šå‘½ä»¤ä¸ä¼ æ„Ÿå™¨è¡¨       | åŠ¨æ€ JSON Schemaï¼Œå¯æ‰©å±• |
| å®‰å…¨      | æ—©æœŸå¼±åŠ å¯†é—®é¢˜å¤š        | å¼ºåˆ¶ TLSã€è§’è‰²/Token    |
| è‡ªåŠ¨åŒ–/å¯ç¼–ç¨‹ | éœ€ä¸“ç”¨å·¥å…·ï¼ˆipmitoolï¼‰ | ä»»ä½• HTTP/JSON å®¢æˆ·ç«¯   |
| äº‘/å¯æ‰©å±•   | æœ‰é™              | åŸç”Ÿæ”¯æŒå¤§è§„æ¨¡ã€äº‘åŸç”Ÿ        |

- bmcwebï¼šC++ å†™çš„ Redfish æœåŠ¡å®ˆæŠ¤è¿›ç¨‹ï¼Œç›‘å¬ 443 ç«¯å£ã€‚
- DBus é€‚é…ï¼šbmcweb é€šè¿‡ DBus è®¿é—®åº•å±‚ä¼ æ„Ÿå™¨ã€ç”µæºç®¡ç†ç­‰å¯¹è±¡ã€‚
- OData/Schemaï¼šç”± redfish-core æ¨¡å—æä¾› JSON Schema ä¸è·¯ç”±ã€‚
- æ‰©å±•ï¼šå‚å•†å¯åœ¨ Oem èŠ‚ç‚¹æä¾›ä¸“ç”¨åŠŸèƒ½è€Œä¸ç ´åæ ‡å‡†ã€‚
  
### å¸¸ç”¨å·¥å…·/SDK
- python-redfishã€redfishtoolï¼ˆDMTF æä¾› CLIï¼‰
- Ansible redfish_* æ¨¡å—ã€Terraform Provider

å…¸å‹ä»»åŠ¡ï¼š  

- æ‰¹é‡ç”µæºæ§åˆ¶ã€å›ºä»¶å‡çº§
- è‡ªåŠ¨åŒ–ç›‘æ§ï¼ˆè®¢é˜…äº‹ä»¶/é¥æµ‹ï¼‰
- ç¡¬ä»¶æ¸…å•ä¸å¥åº·æ£€æŸ¥
  

## IPMIã€Redfish OpenBMC çš„å…³ç³»

- IPMI = å‚³çµ±ã€æ¶ˆæ¯/å‘½ä»¤å°å‘ï¼šè¨­è¨ˆå¹´ä»£æ—©ï¼Œè¼•é‡ä½†åœ¨æ“´å±•æ€§ã€å¯è®€æ€§èˆ‡å®‰å…¨æ€§ä¸Šæœ‰é™ã€‚å¾ˆå¤šç¾å­˜æœå‹™å™¨ã€å·¥å…·éˆä»ä¾è³´ IPMIã€‚Â 
- Redfish = ç¾ä»£ã€REST/JSONï¼šé¢å‘å¯æ“´å±•æ€§ã€å¯ç”¨ç¾æœ‰ web å·¥å…·èˆ‡é›²ç®¡ç†æ£§ï¼Œæ”¯æŒ schemaã€äº‹ä»¶è¨‚é–±ã€æ›´å¥½çš„èªè­‰æ©Ÿåˆ¶ã€‚DMTF å°‡å…¶ä½œç‚ºé¢å‘é›²/å¤§è¦æ¨¡ç®¡ç†çš„ç¾ä»£æ›¿ä»£ã€‚Â 
- BIOSï¼ˆå‚å•†é—­æºï¼Œå¦‚ AMI Aptioï¼‰ã€corebootï¼ˆå¼€æºæ›¿ä»£ï¼‰ã€ä»¥åŠå„ç±»å‚å•†çš„å®šåˆ¶å›ºä»¶ã€‚ä¸»æœºå›ºä»¶å†³å®šäº† OS èƒ½å¦é¡ºåˆ©å¯åŠ¨ã€è®¾å¤‡æ˜¯å¦æœ‰å‚å•†é©±åŠ¨æ”¯æŒã€‚Â 
- BMC èŠ¯ç‰‡/SoCï¼ˆå¸¸è§ä¸”è¢« OpenBMC å¹¿æ³›æ”¯æŒçš„ï¼‰ï¼šASPEED çš„ AST ç³»åˆ—ï¼ˆAST2500/AST2600/AST2700 ç­‰ï¼‰æ˜¯å½“å‰å¸‚åœºä¸Šæœ€å¸¸è§çš„ BMC SoCï¼Œå¾ˆå¤š OpenBMC ç§»æ¤/è®¾å¤‡åŸºäºå®ƒã€‚é€‰æ‹©æ”¯æŒè¿™äº› SoC çš„ç¡¬ä»¶ï¼ŒOpenBMC æˆåŠŸç§»æ¤çš„å¯èƒ½æ€§æ›´é«˜ã€‚Â 
- å•†ä¸š/ä¸“æœ‰ BMC å›ºä»¶ï¼šHPE iLOã€Dell iDRACã€Lenovo XClarityï¼ˆXCCï¼‰ç­‰ â€” åŠŸèƒ½å¼ºã€æ”¯æŒå‚å•†æ•´åˆå·¥å…·ï¼Œä½†ä¸æ˜¯å¼€æºï¼›å¤šæ•°å‚å•†ä¹Ÿæä¾› Redfish å…¼å®¹å±‚ã€‚Â 
- å‚å•†çš„â€œå¼€æº/æ··åˆâ€äº§å“ï¼šAMI çš„ MegaRACï¼ˆåŒ…æ‹¬ MegaRAC OpenEdition / Open-source å˜ä½“ï¼‰åœ¨ä¸šç•Œä¹Ÿè¢«ç”¨ä½œå¯å®šåˆ¶æˆ–è¢«å‚å•†é‡‡çº³çš„ BMC å›ºä»¶æ–¹æ¡ˆï¼ˆAMI ä¹Ÿå¯¹ OpenBMC æœ‰è´¡çŒ®/è¡ç”Ÿï¼‰ã€‚Â ****

  
## å¼€æºæ”¯æŒå¥½çš„æœåŠ¡å™¨

å‡ ç‚¹å…ˆè¯´æ˜ï¼šBMCï¼ˆOpenBMCï¼‰å’Œä¸»æœºæ“ä½œç³»ç»Ÿï¼ˆUbuntu Serverï¼‰æ˜¯ä¸¤å¥—ç‹¬ç«‹è¿è¡Œçš„ç³»ç»Ÿâ€”â€”BMC è´Ÿè´£å¸¦å¤–ç®¡ç†ï¼Œä¸»æœºå›ºä»¶ï¼ˆUEFI/BIOS/corebootï¼‰+é©±åŠ¨å†³å®šä¸»æœºèƒ½å¦è·‘å¥½ Ubuntuã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸»æœºç¡¬ä»¶ï¼ˆCPUã€èŠ¯ç‰‡ç»„ã€ç½‘å¡ã€å­˜å‚¨æ§åˆ¶å™¨ç­‰ï¼‰æœ‰ Linux é©±åŠ¨ï¼ŒUbuntu Server èƒ½è·‘ï¼›BMC æ˜¯â€œé¢å¤–åŠ åˆ†é¡¹â€ï¼ˆæ˜¯å¦å¼€æºã€æ˜¯å¦æ”¯æŒ Redfish/IPMIã€æ˜¯å¦æ˜“äºé›†æˆç›‘æ§ï¼‰ã€‚

- Supermicro çš„éƒ¨åˆ†æ–°å¹³å°ï¼ˆä¾‹å¦‚ä¸€äº› Ampere / ARM / x86 å¹³å°ï¼‰å·²ç»ä»¥ OpenBMC ä¸ºå‡ºå‚ BMCï¼Œå¹¶ä¸”å‚å•†åŒæ—¶å£°æ˜å¯¹ Ubuntu Server / RHEL çš„æ”¯æŒï¼›ç¤¾åŒºæµ‹è¯„ä¹ŸæŠ¥å‘Šäº†åœ¨è¿™äº›æœºå™¨ä¸Šé¡ºåˆ©å®‰è£… Ubuntu Server çš„æ¡ˆä¾‹ï¼ˆä¾‹å¦‚ Supermicro ARS ç³»åˆ—ç­‰ï¼‰ã€‚é€‰æ‹© Supermicro çš„ OpenBMC æœºå‹é€šå¸¸å¯¹å¼€æºç³»ç»Ÿå‹å¥½ã€ç¤¾åŒºæ”¯æŒå¤šã€‚Â 
- OpenBMC é¡¹ç›®æœ¬èº«è¿‘å¹´çš„ upstream æ´»åŠ¨ å·²æ‰©å¤§å¯¹è®¸å¤šå‚è€ƒä¸»æ¿/å‚å•†ï¼ˆTyanã€Supermicroã€Wistronã€IBMã€HPEã€ASRock ç­‰ï¼‰çš„æ”¯æŒï¼Œè¯´æ˜è¶Šæ¥è¶Šå¤šæœåŠ¡å™¨å¹³å°å¯ä»¥æ‹¿åˆ° OpenBMC é•œåƒæˆ–è¾ƒæ˜“ç§»æ¤åˆ° OpenBMCã€‚ä¸»æœºä¸Šè·‘ Ubuntu çš„å¯è¡Œæ€§ä¸»è¦å–å†³äºä¸»æ¿/å¤„ç†å™¨é©±åŠ¨è€Œé BMCã€‚Â 
- NVIDIA / DPU ä¸ BMCï¼šæœ‰å‚å•†ï¼ˆä¾‹å¦‚ NVIDIA çš„éƒ¨åˆ† BMC/DPU æ–¹æ¡ˆï¼‰åŸºäº OpenBMC æ„å»º BMC åŠŸèƒ½ï¼›å®ƒä»¬é€šå¸¸ä¹Ÿæ”¯æŒç”¨ Linux å‘è¡Œç‰ˆï¼ˆå¦‚ Ubuntuï¼‰ä½œä¸ºä¸»æœºæˆ–ç®¡ç†ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼ˆå–å†³äºå¹³å°ï¼‰ã€‚Â 

  

å®ç”¨é€‰è´­å»ºè®®ï¼š

1. ä¼˜å…ˆçœ‹å‚å•†è¯´æ˜â€œOpenBMC / Redfish æ”¯æŒâ€ï¼ˆOpenBMC é¢„è£…æˆ–å‚å•†æä¾› OpenBMC é•œåƒ/æ–‡æ¡£ï¼‰ã€‚Phoronixã€ServeTheHome ç­‰ç¤¾åŒºè¯„æµ‹ä¹Ÿå¸¸ç»™å‡ºå®é™…å…¼å®¹æ€§åé¦ˆã€‚Â 
2. ç¡®è®¤ä¸»æœºå¹³å°å¯¹ Ubuntu çš„å®˜æ–¹/ç¤¾åŒºæ”¯æŒï¼ˆç½‘å¡ã€RAIDã€CPU å®¶æ—çš„é©±åŠ¨ï¼‰ã€‚å³ä¾¿ BMC æ˜¯å¼€æºçš„ï¼Œä¸»æœºç¼ºé©±åŠ¨ä¹Ÿä¼šå¡ä½ã€‚
3. é€‰ç”¨åŸºäº ASPEED AST2600/AST2700 çš„ BMC å¹³å°ï¼ˆOpenBMC ç§»æ¤å·¥ä½œé‡å°ï¼Œç¤¾åŒºæ›´æˆç†Ÿï¼‰ã€‚Â 
4. è‹¥éœ€è¦æœ€å¤§åŒ–â€œå¼€æºå›ºä»¶â€è¡€ç»Ÿï¼Œå¾€ coreboot æ”¯æŒåˆ—è¡¨é‡ŒæŒ‘ä¸»æ¿ï¼ˆä½† coreboot åœ¨æœåŠ¡å™¨çº§åˆ«çš„ç¡¬ä»¶è¦†ç›–ä¸å¦‚ç¬”è®°æœ¬/åµŒå…¥å¼å¹¿æ³›ï¼‰ã€‚


## å›½äº§CPUå¯¹æ¯”

https://plantegg.github.io/2022/01/13/ä¸åŒCPUæ€§èƒ½å¤§PK/



# ESXi ç³»ç»Ÿ

```bash
uname -a
VMkernel localhost 8.0.3 #1 SMP Release build-24674464 AprÂ  1 2025 04:16:09 x86_64 x86_64 x86_64 ESXi

vmware -v
VMware ESXi 8.0.3 build-24674464

esxcli system version get
Â Â  Product: VMware ESXi
Â Â  Version: 8.0.3
Â Â  Build: Releasebuild-24674464
Â Â  Update: 3
Â Â  Patch: 70

df -h
Filesystem Â  Size Â  Used Available Use% Mounted on
VMFS-6 Â  Â  Â  3.4T Â  2.4TÂ  Â  963.5GÂ  72% /vmfs/volumes/datastore1
VMFSOS Â  Â  119.8G Â  5.3GÂ  Â  114.4G Â  4% /vmfs/volumes/OSDATA-695a2b3b-7c5ae918-7045-ec2a7248c156
vfat Â  Â  Â  Â  4.0G 262.5MÂ  Â  Â  3.7G Â  6% /vmfs/volumes/BOOTBANK1
vfat Â  Â  Â  Â  4.0GÂ  64.0KÂ  Â  Â  4.0G Â  0% /vmfs/volumes/BOOTBANK2


```


## ESXi GPU ç›´é€š

åœ¨æŸä¸€å° Ubuntu è™šæ‹Ÿæœºé‡Œç”¨ RTX 4090 åš LLM æ¨ç†ï¼Œåº”è¯¥ GPU ç›´é€šï¼ˆVMDirectPath I/O / Passthroughï¼‰ï¼š

- ESXi ä¸»æœºä¸Šä¸€èˆ¬ä¸éœ€è¦è£…â€œæ˜¾å¡é©±åŠ¨â€ï¼›ä½ è¦åšçš„æ˜¯æŠŠ GPU é…æˆ Passthroughï¼Œè®©è™šæ‹Ÿæœºç›´æ¥æ¥ç®¡å®ƒ
- çœŸæ­£çš„ NVIDIA é©±åŠ¨/CUDA è¦è£…åœ¨ Ubuntu è™šæ‹Ÿæœºé‡Œ

å¦å¤–ï¼ŒRTX 4090 è¿™ç§æ¶ˆè´¹å¡ä¹Ÿä¸èµ° vGPU é‚£æ¡è·¯ï¼ˆvGPU éœ€è¦ç‰¹å®šæ”¯æŒçš„å¡å’Œå¯¹åº”çš„ vGPU host driver/è®¸å¯ï¼‰ï¼Œå¸¸è§åšæ³•è¿˜æ˜¯ç›´é€šã€‚NVIDIA vGPU çš„ vSphere release notes é‡Œåˆ—çš„æ”¯æŒå‹å·ä¸»è¦æ˜¯ A10/A16/A40/RTX A ç³»åˆ—ç­‰ï¼Œå¹¶æ²¡æœ‰ 4090 è¿™ç±»æ¶ˆè´¹å¡ã€‚

### 1) æœåŠ¡å™¨ BIOS è®¾ç½®

åœ¨ Dell T640 çš„ BIOS é‡Œç¡®è®¤ï¼š

1. å¯ç”¨ IOMMU
    - Intel å¹³å°é€šå¸¸æ˜¯ VT-dï¼ˆT640 å¸¸è§æ˜¯ Intelï¼‰
2. Above 4G Decodingï¼šå»ºè®®å¼€å¯
3. å¯åŠ¨æ¨¡å¼å»ºè®® UEFIï¼ˆåé¢ VM ä¹Ÿä¼šç”¨ UEFIï¼‰

### 2) ESXi ä¸»æœºä¾§ï¼šå¯ç”¨ Passthrough

åœ¨ vSphere Clientï¼š
1. Host â†’ Manage â†’ Hardware â†’ PCI Devices
2. æ‰¾åˆ° RTX 4090 ä»¥åŠå®ƒå¯¹åº”çš„ HD Audio åŠŸèƒ½ï¼ˆé€šå¸¸æ˜¯åŒä¸€å—å¡çš„å¦ä¸€ä¸ª PCI functionï¼‰
3. åˆ†åˆ«å‹¾é€‰ Passthrough
4. é‡å¯ ESXi
  
è¯´æ˜ï¼šæŠŠ PCI è®¾å¤‡åˆ†é…ç»™ VM åï¼ŒVM éœ€è¦å¯¹å…¶â€œé…ç½®çš„å…¨éƒ¨å†…å­˜â€åš reservationï¼ˆä¸‹é¢ä¼šåšï¼‰ã€‚

---
### 3) è™šæ‹Ÿæœºä¾§ï¼š

å…³é”®è®¾ç½®ï¼ˆå¾ˆé‡è¦ï¼Œé¿å…â€œPower on failed / PCIPassthruLateâ€ï¼‰æŠŠ GPU åŠ åˆ° Ubuntu VM ä¹‹å‰ï¼Œå…ˆæŠŠè¿™äº› VM çº§è®¾ç½®å¤„ç†å¥½ï¼š

#### A. å›ºä»¶ç”¨ UEFI

VM Options â†’ Boot Options â†’ Firmware é€‰ EFI/UEFIã€‚
NVIDIA æ–‡æ¡£ä¹Ÿæ˜ç¡®ï¼šå¦‚æœ BAR1 è¶…è¿‡ 256MBï¼ŒVM å¿…é¡»ç”¨ EFI å¯åŠ¨ã€‚

#### B. ç»™ VM å†…å­˜åšå…¨é¢ Reservation

Edit Settings â†’ Memory â†’ Reservation è®¾æˆ ç­‰äºè¯¥ VM é…ç½®å†…å­˜æ€»é‡ã€‚
è¿™æ˜¯ VMware å¯¹ç›´é€šè®¾å¤‡çš„ç¡¬æ€§è¦æ±‚ä¹‹ä¸€ã€‚

#### C. å¯ç”¨ 64-bit MMIOï¼Œå¹¶è®¾ç½®è¶³å¤Ÿçš„ MMIO ç©ºé—´

å¾ˆå¤šé«˜ç«¯ GPUï¼ˆå°¤å…¶å¸¦å¤§ BAR/å¯è°ƒæ•´ BAR çš„ï¼‰åœ¨ ESXi ä¸Šç›´é€šæ—¶ï¼Œä¼šå› ä¸º MMIO ç©ºé—´ä¸è¶³å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚Dell çš„ KB ç»™äº†æ ‡å‡†åšæ³•ï¼šåœ¨ VMX é‡ŒåŠ 

- pciPassthru.use64bitMMIO="TRUE"
- pciPassthru.64bitMMIOSizeGB="..."ï¼ˆæŒ‰ GPU æ˜¾å­˜ç­‰ä¼°ç®—å¹¶å‘ä¸Šå– 2 çš„å¹‚ï¼‰

ä½ è¿™å¼  4090 æ˜¯ 24GB æ˜¾å­˜ï¼Œå¸¸ç”¨çš„å–å€¼æ˜¯ 32ï¼ˆå‘ä¸Šå–åˆ° 2 çš„å¹‚ï¼‰ã€‚

åšæ³•ï¼ˆä¸¤ç§ä»»é€‰å…¶ä¸€ï¼‰ï¼š

- vSphere Client é‡Œï¼šVM â†’ Edit Settings â†’ Advanced Parametersï¼ˆæˆ– â€œConfiguration Parametersâ€ï¼‰æ·»åŠ ä¸Šè¿°ä¸¤æ¡
- æˆ–ç›´æ¥ç¼–è¾‘ VM çš„ .vmx æ–‡ä»¶åŠ ä¸Šä¸¤è¡Œï¼ˆæ›´ç›´è§‚ï¼‰

### 4) æŠŠ GPU åŠ åˆ° VM

VM å…³æœºçŠ¶æ€ä¸‹ï¼š
Edit Settings â†’ Add New Device â†’ PCI Device
æŠŠ 4090ï¼ˆä»¥åŠéœ€è¦çš„è¯åŠ ä¸Šå®ƒçš„ Audio functionï¼‰åŠ è¿›å»ï¼Œç„¶åå¼€æœºã€‚
æ³¨æ„ï¼šå¯ç”¨ç›´é€šåï¼Œè¿™å° VM ä¸€èˆ¬å°±ä¸èƒ½ vMotionï¼ŒæŸäº›å¿«ç…§/å®¹é”™ç‰¹æ€§ä¹Ÿä¼šå—é™ï¼ˆè¿™æ˜¯ç›´é€šçš„å…¸å‹é™åˆ¶ï¼‰ã€‚

### 5) Ubuntu è™šæ‹Ÿæœºé‡Œè£… NVIDIA é©±åŠ¨

è¿› Ubuntu åæŒ‰è¿™å¥—åšå³å¯ï¼š

1. ç¡®è®¤èƒ½çœ‹åˆ°å¡
```
lspci | grep -i nvidia
```

2. ç”¨ Ubuntu æ¨èé©±åŠ¨å®‰è£…
```
sudo apt update
ubuntu-drivers devices
sudo apt install -y nvidia-driver-XXX
sudo reboot
```

XXX ç”¨ ubuntu-drivers devices æ¨èçš„ç‰ˆæœ¬æ›¿æ¢ã€‚

3. é‡å¯åéªŒè¯
```
nvidia-smi
```

å¦‚æœç”¨ Docker è·‘æ¨ç†ï¼ˆvLLM/TGI/ollama ç­‰ï¼‰ï¼Œå†è£… NVIDIA Container Toolkitï¼Œç„¶å docker run --gpus all ... å³å¯ã€‚

### å¸¸è§æ•…éšœå¿«é€Ÿå®šä½

1. VM å¼€æœºæŠ¥ â€œModule â€˜DevicePowerOnâ€™ power on failedâ€ æˆ–ç±»ä¼¼ PCIPassthruLate é”™è¯¯
    ä¼˜å…ˆæ£€æŸ¥ï¼šUEFI å›ºä»¶ + 64bit MMIO + 64bitMMIOSizeGB + å…¨é¢å†…å­˜ reservationã€‚Dell KB å’Œ VMware/Broadcom çš„è¦æ±‚åŸºæœ¬å°±æ˜¯ä¸ºäº†è§£è¿™ä¸ªã€‚
    
2. Ubuntu é‡Œçœ‹å¾—åˆ°æ˜¾å¡ä½† nvidia-smi æŠ¥é”™
    é€šå¸¸æ˜¯é©±åŠ¨ç‰ˆæœ¬ä¸åŒ¹é…æˆ– Secure Boot/ç­¾åæ¨¡å—é—®é¢˜ï¼ˆå¦‚æœä½ åœ¨ VM é‡Œå¼€äº† secure bootï¼‰ï¼Œå…ˆç¡®ä¿ VM ç”¨ UEFI ä½†ä¸å¼ºåˆ¶ secure bootï¼Œæˆ–è€…æŒ‰å‘è¡Œç‰ˆæ–¹å¼è£…ç­¾åé©±åŠ¨ã€‚


# ç£ç›˜é—®é¢˜


## 7zipå‹ç¼©å¤±è´¥(ç£ç›˜æŸå)

```bash
âœ  pg-databases /usr/bin/7za a -mx=0 iep-admin-matou.7z iep-admin-matou-2026-01-08-01-00.sql

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=zh_CN.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs Intel(R) Core(TM) i5-7400 CPU @ 3.00GHz (906E9),ASM,AES-NI)

Scanning the drive:
1 file, 7341663241 bytes (7002 MiB)

Creating archive: iep-admin-matou.7z

Items to compress: 1

System ERROR:
æœªçŸ¥çš„é”™è¯¯ -2147024891
```

### 1. æƒé™-ç£ç›˜ç©ºé—´é—®é¢˜?

```bash
âœ  pg-databases ls -la                                             
total 7132752
drwxr-x--- 2 root root       4096 Jan  8 09:45 .
drwxr-xr-x 6 root root       4096 Jan  4 15:58 ..
-rw-r--r-- 1 root root         32 Jan  8 09:21 iep-admin-matou-2026-01-07-09-26.7z
-rw-r--r-- 1 root root 7341663241 Jan  8 01:03 iep-admin-matou-2026-01-08-01-00.sql
âœ  pg-databases df -hT            
Filesystem     Type      Size  Used Avail Use% Mounted on
tmpfs          tmpfs     3.2G  2.9M  3.2G   1% /run
efivarfs       efivarfs  256K   44K  208K  18% /sys/firmware/efi/efivars
/dev/sda2      ext4      916G  110G  760G  13% /
tmpfs          tmpfs      16G     0   16G   0% /dev/shm
tmpfs          tmpfs     5.0M  4.0K  5.0M   1% /run/lock
/dev/sda1      vfat      511M  6.1M  505M   2% /boot/efi
/dev/md0       ext4      6.4T  2.1T  4.0T  35% /raid0data
tmpfs          tmpfs     3.2G   76K  3.2G   1% /run/user/128
tmpfs          tmpfs     3.2G   64K  3.2G   1% /run/user/0
...

âœ  pg-databases echo $USER
root
```
æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚

### 2. 7zip ç‰ˆæœ¬é—®é¢˜?

**`p7zip`Â ç‰ˆæœ¬ (16.02) ç¡®å®å¤ªè€äº†ã€‚**

- **å‘å¸ƒæ—¶é—´ï¼š**Â 2016 å¹´ã€‚
- **çŠ¶æ€ï¼š**Â åŸå§‹çš„Â `p7zip`Â é¡¹ç›®ï¼ˆLinux ç§»æ¤ç‰ˆï¼‰å·²ç»**åœæ­¢ç»´æŠ¤å¤šå¹´**ã€‚å®ƒå¯¹å¤§äº 4GB çš„æ–‡ä»¶æ”¯æŒã€å¤šçº¿ç¨‹å¤„ç†ä»¥åŠæ–°çš„ç³»ç»Ÿ API å…¼å®¹æ€§éƒ½å­˜åœ¨å·²çŸ¥é—®é¢˜ã€‚è¿™å¾ˆå¯èƒ½å°±æ˜¯ä½ é‡åˆ°Â `-2147024891`Â (Access Denied/Seek Error) é”™è¯¯çš„æ ¹æœ¬åŸå› ã€‚

ç°åœ¨çš„å®˜æ–¹ 7-Zip ä½œè€…å·²ç»æ¨å‡ºäº†**å®˜æ–¹çš„ Linux ç‰ˆæœ¬**ï¼ˆä¸å†å« p7zipï¼‰ã€‚

ä»¥ä¸‹æ˜¯åœ¨ Ubuntu ä¸Šå®‰è£…æœ€æ–°ç‰ˆï¼ˆå®˜æ–¹ç‰ˆï¼‰çš„æ­¥éª¤ï¼š

é¦–å…ˆï¼Œä¸ºäº†é¿å…å‘½ä»¤å†²çªï¼Œå…ˆå¸è½½æ—§çš„Â `p7zip`ï¼š

```bash
apt remove p7zip p7zip-full p7zip-rar
apt update
apt install 7zip

7zz --help   
7-Zip (z) 21.07 (x64) : Copyright (c) 1999-2021 Igor Pavlov : 2021-12-26
 64-bit locale=C.UTF-8 Threads:4
Usage: 7zz <command> [<switches>...] <archive_name> [<file_names>...] [@listfile]
...

```

æ¥ä¸‹æ¥å°è¯•æ–°ç‰ˆæœ¬çš„7zipå’Œtarï¼Œéƒ½ä¸è¡Œï¼Œæ€€ç–‘æ˜¯ç£ç›˜é—®é¢˜ã€‚
```bash
âœ  pg-databases 7zz a -mx=3 iep-admin-matou.7z iep-admin-matou-2026-01-08-01-00.sql

7-Zip (z) 21.07 (x64) : Copyright (c) 1999-2021 Igor Pavlov : 2021-12-26
 64-bit locale=C.UTF-8 Threads:4

Scanning the drive:
1 file, 7341663241 bytes (7002 MiB)
Creating archive: iep-admin-matou.7z
Add new data to archive: 1 file, 7341663241 bytes (7002 MiB)                                     
ERROR: errno=5 : è¾“å…¥/è¾“å‡ºé”™è¯¯
iep-admin-matou-2026-01-08-01-00.sql
System ERROR:
errno=5 : è¾“å…¥/è¾“å‡ºé”™è¯¯

âœ  pg-databases tar -czf iep-admin-matou.tar.gz iep-admin-matou-2026-01-08-01-00.sql
tar: iep-admin-matou-2026-01-08-01-00.sql: File shrank by 6946083849 bytes; padding with zeros
```

### 3. ç£ç›˜æŸåé—®é¢˜

#### 3.1 æŸ¥çœ‹å†…æ ¸æ—¥å¿—

```bash
dmesg -T | tail -n 20

[Thu Jan  8 10:19:17 2026] ata3.00: cmd 60/30:f0:c8:33:48/00:00:15:00:00/40 tag 30 ncq dma 24576 in
                                    res 40/00:00:00:00:00/00:00:00:00:00/00 Emask 0x50 (ATA bus error)
[Thu Jan  8 10:19:17 2026] ata3.00: status: { DRDY }
[Thu Jan  8 10:19:17 2026] ata3: hard resetting link
[Thu Jan  8 10:19:18 2026] EXT4-fs error (device md0): __ext4_find_entry:1694: inode #30086286: comm MergeMutate: checksumming directory block 0
[Thu Jan  8 10:19:18 2026] EXT4-fs error (device md0): ext4_dx_find_entry:1798: inode #137828834: block 15: comm MergeMutate: Directory block failed checksum
[Thu Jan  8 10:19:18 2026] EXT4-fs error (device md0): __ext4_find_entry:1694: inode #30086286: comm MergeMutate: checksumming directory block 0
[Thu Jan  8 10:19:21 2026] ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 310)
[Thu Jan  8 10:19:21 2026] ata3.00: configured for UDMA/33
[Thu Jan  8 10:19:21 2026] ata3: EH complete
[Thu Jan  8 10:19:22 2026] EXT4-fs error (device md0): __ext4_find_entry:1694: inode #30086286: comm MergeMutate: checksumming directory block 0
[Thu Jan  8 10:19:22 2026] EXT4-fs error (device md0): __ext4_find_entry:1694: inode #30086286: comm MergeMutate: checksumming directory block 0
[Thu Jan  8 10:19:23 2026] EXT4-fs error (device md0): ext4_dx_find_entry:1798: inode #137828834: block 15: comm MergeMutate: Directory block failed checksum
[Thu Jan  8 10:19:23 2026] EXT4-fs error (device md0): __ext4_find_entry:1694: inode #30086286: comm MergeMutate: checksumming directory block 0
[Thu Jan  8 10:19:25 2026] [UFW BLOCK] IN=enp2s0 OUT= MAC=01:00:5e:00:00:01:3c:7c:3f:e3:37:00:08:00 SRC=192.168.50.1 DST=224.0.0.1 LEN=36 TOS=0x00 PREC=0x00 TTL=1 ID=2364 DF PROTO=2 
[Thu Jan  8 10:19:27 2026] ata3: SATA link up 1.5 Gbps (SStatus 113 SControl 310)
[Thu Jan  8 10:19:27 2026] ata3.00: configured for UDMA/33
[Thu Jan  8 10:19:27 2026] EXT4-fs error (device md0): ext4_dx_find_entry:1798: inode #137828834: block 15: comm MergeMutate: Directory block failed checksum
[Thu Jan  8 10:19:28 2026] EXT4-fs error (device md0): ext4_dx_csum_verify:502: inode #137757167: comm MergeMutate: dir seems corrupt?  Run e2fsck -D.
[Thu Jan  8 10:19:28 2026] EXT4-fs error (device md0): dx_probe:823: inode #137757167: comm MergeMutate: Directory index failed checksum

```

#### 3.2 æ£€æŸ¥æ–‡ä»¶å®Œæ•´åº¦

```bash

âœ  dd if=iep-admin-matou-2026-01-08-01-00.sql of=/dev/null bs=4M status=progress

395579392 bytes (396 MB, 377 MiB) copied, 25 s, 15.6 MB/s
dd: error reading 'iep-admin-matou-2026-01-08-01-00.sql': Input/output error
94+1 records in
94+1 records out
395579392 bytes (396 MB, 377 MiB) copied, 35.9601 s, 11.0 MB/s

âœ  md5sum iep-admin-matou-2026-01-08-01-00.sql
md5sum: iep-admin-matou-2026-01-08-01-00.sql: Input/output error
```

#### 3.3 æŸ¥çœ‹ç£ç›˜å¥åº·ç¨‹åº¦

```bash
apt install smartmontools

# å…ˆçœ‹æ€»ä½“å¥åº· + å…³é”®å±æ€§
for d in sda sdb sdc sdd sde sdf; do
    echo "===== /dev/$d ====="
    smartctl -H -A /dev/$d
done

smartctl -a /dev/sdcÂ Â # sdc æ˜¯ç¡®å®šçš„åç›˜ç¬¦
```

| ç¡¬ç›˜        | çŠ¶æ€    | å…³é”®é—®é¢˜                                    |
| --------- | ----- | --------------------------------------- |
| **sda/b** | âœ… å¥åº·  | æ— é—®é¢˜                                     |
| **sdc**   | ğŸ”´ æ•…éšœ | 88 åæ‰‡åŒºï¼ŒSATA é™é€Ÿåˆ° 1.5Gbpsï¼ŒATA æ€»çº¿é”™è¯¯        |
| **sdd**   | ğŸ”´ ä¸¥é‡ | **1950 ä¸ª Reported_Uncorrect**ï¼ˆæ¯” sdc æ›´ç³Ÿï¼‰ |
| **sde**   | âœ… å¥åº·  | æ— é—®é¢˜                                     |
| **sdf**   | âœ… å¥åº·  | æ— é—®é¢˜                                     |

#### 3.4 æ–‡ä»¶æŠ¢æ•‘

```bash
apt installÂ gddrescue

# è¦ç¡®è®¤ç›®æ ‡æ–‡ä»¶å¤¹çš„åˆ†åŒºæ˜¯å¥åº·çš„ã€‚
ddrescue -d -r3 iep-admin-matou-2026-01-08-01-00.sql /home/iep-2026-01-08-backup.sql /home/iep-2026-01-08-backup.log

GNU ddrescue 1.23
Press Ctrl-C to interrupt
Â Â  Â  ipos:Â  Â  1089 MB, non-trimmed:Â  Â  Â  Â  0 B,Â  current rate: Â  Â  Â  0 B/s
Â Â  Â  opos:Â  Â  1089 MB, non-scraped:Â  Â  Â  Â  0 B,Â  average rate: Â  4221 kB/s
non-tried:Â  Â  Â  Â  0 B,Â  bad-sector: Â  Â  8192 B,Â  Â  error rate: Â  Â  170 B/s
Â  rescued:Â  Â  7341 MB, Â  bad areas:Â  Â  Â  Â  2,Â  Â  Â  Â  run time: Â  Â  28m 59s
pct rescued: Â  99.99%, read errors: Â  Â  Â  66,Â  remaining time: Â  Â  Â  Â  n/a
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time since last successful read: Â  Â  10mÂ  2s
Finished
```

æ£€æŸ¥æŠ¢æ•‘çš„æ–‡ä»¶ï¼š

```bash
âœ  dd if=/home/iep-2026-01-08-backup.sql of=/dev/null bs=4M status=progress

7075790848 bytes (7.1 GB, 6.6 GiB) copied, 13 s, 544 MB/s
1750+1 records in
1750+1 records out
7341663241 bytes (7.3 GB, 6.8 GiB) copied, 13.3978 s, 548 MB/s

âœ  tail -n 20 /home/iep-2026-01-08-backup.log
# Mapfile. Created by GNU ddrescue version 1.23
# Command line: ddrescue -d -r3 iep-admin-matou-2026-01-08-01-00.sql /home/iep-2026-01-08-backup.sql /home/iep-2026-01-08-backup.log
# Start time:   2026-01-08 11:04:58
# Current time: 2026-01-08 11:33:57
# Finished
# current_pos  current_status  current_pass
0x40F0AE00     +               3
#      pos        size  status
0x00000000  0x17941000  +
0x17941000  0x00001000  -
0x17942000  0x295C8000  +
0x40F0A000  0x00001000  -
0x40F0B000  0x174A83409  +

# çœ‹æ´ä½ç½®é™„è¿‘ 64 å­—èŠ‚ï¼ˆæ´å¼€å§‹å‰ 32 + æ´å¼€å§‹å 32ï¼‰
f=/home/iep-2026-01-08-backup.sql
for off in $((0x17941000)) $((0x40F0A000)); do
  echo "=== offset=$off ==="
  dd if="$f" bs=1 skip=$((off-32)) count=64 2>/dev/null | hexdump -C
done

=== offset=395579392 ===
00000000  35 33 32 35 39 30 33 32  37 39 36 5f 34 33 30 5f  |53259032796_430_|
00000010  31 37 36 30 36 30 34 36  32 39 39 37 38 5f 36 30  |1760604629978_60|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000040
=== offset=1089511424 ===
00000000  7d 5d 2c 20 22 6f 75 74  70 75 74 4c 69 73 74 22  |}], "outputList"|
00000010  3a 20 5b 7b 22 6e 61 6d  65 22 3a 20 22 4f 55 54  |: [{"name": "OUT|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000040
```

ç¡®è®¤ï¼šè¿™ä¸¤å¤„åå—åœ¨å¤‡ä»½æ–‡ä»¶é‡Œè¢« **0x00 è¿ç»­å¡«å……**ï¼Œè€Œä¸”å®ƒä»¬éƒ½è½åœ¨â€œæ–‡æœ¬å†…å®¹â€çš„ä¸­é—´ï¼ˆå‰é¢è¿˜æ˜¯æ­£å¸¸ ASCII/JSON å­—ç¬¦ï¼Œåé¢ç›´æ¥å˜æˆä¸€ä¸² 00ï¼‰ã€‚è¿™å¯¹çº¯ SQL æ–‡æœ¬æ¥è¯´é€šå¸¸ä¼šå¯¼è‡´å¯¼å…¥æ—¶æŠ¥é”™ï¼Œå› ä¸ºï¼š

- PostgreSQL çš„ psql/æœåŠ¡å™¨ç«¯å¹¶ä¸æœŸå¾… SQL æ–‡ä»¶é‡Œå‡ºç° NUL å­—èŠ‚
- å³ä½¿èƒ½è¯»è¿‡å»ï¼Œä¹Ÿä¼šæŠŠé‚£ä¸€è¡Œ/é‚£æ®µ COPY æ•°æ®ç ´åæ‰

åäº†ä¸¤æ®µï¼Œå„ 4KiBï¼Œé€šå¸¸å¯ä»¥åšåˆ°â€œåº“ç»“æ„å’Œç»å¤§å¤šæ•°æ•°æ®æ¢å¤â€ï¼Œåçš„é‚£ä¸€å°æ®µæŒ‰è¡¨/æŒ‰æ®µè·³è¿‡æˆ–é‡åšã€‚

**1ï¼‰å…ˆæ‰¾å‡º NUL è½åœ¨æ–‡ä»¶çš„å“ªä¸€è¡Œï¼ˆå®šä½åˆ°å¯¹è±¡/è¡¨ï¼‰**

ç”¨ perl ç»Ÿè®¡åˆ°ç¬¬ä¸€ä¸ª NUL åœ¨ç¬¬å‡ è¡Œï¼š
```bash
perl -ne 'if (index($_, "\0") != -1) { print "NUL at line $. \n"; exit 0 }' /home/iep-2026-01-08-backup.sql
```

å†æ‰¾ç¬¬äºŒä¸ª NULï¼ˆç¨å¾®æ”¹ä¸€ä¸‹ï¼Œä»åé¢ç»§ç»­æ‰¾ï¼‰ï¼š
```bash
perl -ne 'BEGIN{$seen=0} if (index($_, "\0") != -1) { $seen++; print "NUL #$seen at line $. \n"; exit 0 if $seen==2 }' /home/iep-2026-01-08-backup.sql
```

**2ï¼‰æŠŠ NUL é‚£ä¸€è¡Œé™„è¿‘å†…å®¹æ‰“å°å‡ºæ¥ï¼ˆçœ‹æ˜¯ COPY å“ªå¼ è¡¨ï¼‰**

æ‹¿åˆ°è¡Œå·åï¼ˆæ¯”å¦‚æ˜¯ Lï¼‰ï¼Œçœ‹ä¸Šä¸‹æ–‡ï¼š
```bash
L=ä½ å¾—åˆ°çš„è¡Œå·
sed -n "$((L-5)),$((L+5))p" /home/iep-2026-01-08-backup.sql | cat -n
```

å¦‚æœé™„è¿‘èƒ½çœ‹åˆ° COPY ... FROM stdin;ï¼Œé‚£å°±å‡ ä¹ç¡®å®šååœ¨æŸå¼ è¡¨çš„æ•°æ®æ®µã€‚

##### **ä¿®å¤æ€è·¯

åœºæ™¯ Aï¼šåå—åœ¨COPY ... FROM stdin;çš„æ•°æ®è¡Œé‡Œï¼ˆæœ€å¸¸è§ï¼‰

åšæ³•æ˜¯æŠŠé‚£æ®µ COPY æ•°æ®åˆ æ‰æˆ–è·³è¿‡ï¼Œè®©å…¶å®ƒè¡¨ç»§ç»­å¯¼å…¥ã€‚

æœ€ç¨³çš„å¯¼å…¥ç­–ç•¥æ˜¯ä¸¤æ­¥ï¼š

1ï¼‰å…ˆè®©å¯¼å…¥â€œç»§ç»­è·‘â€ï¼ŒæŠŠèƒ½å¯¼çš„éƒ½å¯¼è¿›å»ï¼ˆä¸ä¸­æ–­ï¼‰ï¼š
```bash
psql -X -v ON_ERROR_STOP=0 -f /home/iep-2026-01-08-backup.sql your_dbname 2> /tmp/import.err
```

2ï¼‰ç„¶åæ ¹æ® /tmp/import.err é‡ŒæŠ¥é”™çš„è¡¨å/è¡Œå·ï¼Œå» SQL æ–‡ä»¶é‡Œå®šä½å¯¹åº”çš„ COPY æ®µï¼Œåˆ é™¤è¯¥ COPY æ®µï¼ˆä» COPY ... FROM stdin; åˆ° \.ï¼‰ï¼Œé‡æ–°å¯¼å…¥ã€‚

åœºæ™¯ Bï¼šåå—è½åœ¨ DDL/å‡½æ•°/ç´¢å¼•å®šä¹‰é‡Œï¼ˆç›¸å¯¹éº»çƒ¦ï¼‰

è¿™ç§ä¼šå½±å“å»ºè¡¨/å»ºå‡½æ•°è¯­å¥å®Œæ•´æ€§ï¼Œé€šå¸¸è¦ä¹ˆï¼š
- é‡æ–°ä»æºåº“å¯¼å‡ºï¼ˆæœ€æ¨èï¼‰
- æˆ–è€…åœ¨å¤‡ä»½æ–‡ä»¶ä¸­æ‰‹å·¥ä¿®è¡¥é‚£æ®µ SQLï¼ˆéš¾åº¦å–å†³äºç¼ºå¤±ä½ç½®ï¼‰


#### 3.5 ç£ç›˜ä¿®å¤


# æœåŠ¡å™¨ç›‘æ§


## [Netdata](https://github.com/netdata/netdata)

### [å®‰è£…](https://learn.netdata.cloud/docs/netdata-agent/installation/)

#### docker éƒ¨ç½²

```bash
docker pull netdata/netdata

docker run -d --name=netdata \
  --pid=host \
  --network=host \
  -e NETDATA_CLAIM_URL="" \
  -e NETDATA_DISABLE_CLOUD=1 \
  -v netdataconfig:/etc/netdata \
  -v netdatalib:/var/lib/netdata \
  -v netdatacache:/var/cache/netdata \
  -v /:/host/root:ro,rslave \
  -v /etc/passwd:/host/etc/passwd:ro \
  -v /etc/group:/host/etc/group:ro \
  -v /etc/localtime:/etc/localtime:ro \
  -v /proc:/host/proc:ro \
  -v /sys:/host/sys:ro \
  -v /etc/os-release:/host/etc/os-release:ro \
  -v /var/log:/host/var/log:ro \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  -v /run/dbus:/run/dbus:ro \
  --restart always \
  --cap-add SYS_PTRACE \
  --cap-add SYS_ADMIN \
  --security-opt apparmor=unconfined \
  netdata/netdata

vim /var/lib/netdata/cloud.d/cloud.conf

# æ·»åŠ å¦‚ä¸‹å†…å®¹ä¿å­˜
[global]
Â  enabled = no
Â  
docker restart netdata
```

è®¿é—®ï¼š`http://localhost:19999/v3`å¯ä»¥çœ‹åˆ°ç›‘æ§çš„ç»†èŠ‚ã€‚


# dellæœåŠ¡å™¨é£æ‰‡é—®é¢˜

## æ€»ç»“åœ¨å‰
å…·ä½“æŠ€æœ¯ç»†èŠ‚å’Œå‚è€ƒé“¾æ¥è§ä¸‹æ–‡ã€‚

- dell æœåŠ¡å™¨å®‰è£…äº†ç¬¬ä¸‰æ–¹é…ä»¶å¦‚PCIEå¡ã€å›ºæ€ã€æ˜¾å¡ç­‰ï¼Œå°±ä¼šå¯¼è‡´é£æ‰‡è‡ªåŠ¨æ§åˆ¶åºŸæ‰ã€‚
- æœ¬æ¥å¯ä»¥é€šè¿‡IPMIè®¾ç½®ä¸ºæ‰‹åŠ¨æ§åˆ¶è§£å†³ï¼Œç»“æœä»–åœ¨iDRAC 3.34ç‰ˆæœ¬åç§»é™¤äº†æ”¹æ”¯æŒã€‚
- ä½†æ˜¯è¿˜èƒ½é™ç‰ˆæœ¬é‡è£…è§£å†³ï¼Œbut ç‰ˆæœ¬7.00.00.172 or newerè®¾ç½®æ— æ³•é™çº§ã€‚ã€‚ã€‚
- æˆ–è€…å–æ¶ˆç¬¬pandä¸‰æ–¹sgè®¾å¤‡çš„guanå…³è”ï¼Œä½†æ˜¯7.00zhiâ€†houâ€†haiâ€†shiaä¹‹åè¿˜æ˜¯ä¸è¡Œäº†ã€‚
- racadmå°±æ˜¯iDRACçš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œå‡ ä¹æ²¡æœ‰æ ¼å¤–çš„æ§åˆ¶åŠŸèƒ½ã€‚

## refs
- [ipmitool control PowerEdge fan](https://www.reddit.com/r/homelab/comments/t9pa13/dell_poweredge_fan_control_with_ipmitool/?tl=zh-hans)
- [fan_controller_Docker](https://github.com/tigerblue77/Dell_iDRAC_fan_controller_Docker)
- [æœåŠ¡å™¨çš„BMCï¼ŒIPMIä»‹ç»ä»¥åŠDellæœåŠ¡å™¨é£æ‰‡é™é€Ÿæ–¹æ³•](https://zhuanlan.zhihu.com/p/157796567)
- [reddit-adjust_the_fan_speed](https://www.reddit.com/r/homelab/comments/101u7br/how_can_i_adjust_the_fan_speed_beyond_low_offset/?tl=zh-hans)
- [Dell Fan Noise Control - Silence Your Poweredge](https://old.reddit.com/r/homelab/comments/7xqb11/dell_fan_noise_control_silence_your_poweredge/)

- [idrac9_downgrade](https://www.reddit.com/r/homelab/comments/1byc5pv/r740xd_idrac9_downgrade/?tl=zh-hans)
- [Dell ENG is taking away fan speed control away from users ( iDrac >= 3.34.34.34)](https://www.dell.com/community/en/conversations/poweredge-hardware-general/dell-eng-is-taking-away-fan-speed-control-away-from-users-idrac-3343434/647f8593f4ccf8a8de47aa9b)
- [Custom Cooling Fan Options for Dell EMC PowerEdge Servers](https://dl.dell.com/manuals/common/customcooling_poweredge_idrac9.pdf?dgc=SM&cid=243907&lid=spr5090153920&linkId=123036317](https://dl.dell.com/manuals/common/customcooling_poweredge_idrac9.pdf?dgc=SM&cid=243907&lid=spr5090153920&linkId=123036317))
- [iDRAC9 - RAC0181 - Firmware Downgrade Failures on 14G 15G Servers](https://www.dell.com/support/kbdoc/en-us/000225924/rac0181-idrac9-firmware-downgrade-failures-on-14-15g-poweredge-servers](https://www.dell.com/support/kbdoc/en-us/000225924/rac0181-idrac9-firmware-downgrade-failures-on-14-15g-poweredge-servers))
- [dellè½¬é€Ÿå¼‚å¸¸](https://www.dell.com/community/zh/conversations/poweredgeæœåŠ¡å™¨/r7525é£æ‰‡è½¬é€Ÿå¼‚å¸¸/66bde9d047effa74c48587c6)

## ipmitool
```bash
sudo apt install -y ipmitool

# å»iDRACè®¾ç½®å¯†ç ï¼ŒæŠŠã€Šå¯åŠ¨LANä¼¤çš„IPMIã€‹æ‰“å¼€ï¼Œå–æ¶ˆå¯†é’¥ï¼ˆå…¨è®¾ç½®0ï¼‰å¦åˆ™ä¼šæŠ¥é”™ï¼šæ— æ³•å»ºç«‹ IPMI v2 / RMCP+ ä¼šè¯
sudo ipmitool -I lanplus -H 192.168.4.100 -U root -P "pwd*1234" sdr elist all

# æŸ¥çœ‹ä¿¡æ¯
sudo ipmitool -I lanplus -H 192.168.4.100 -U root -P "pwd*1234" mc info

# Dell Fan Control Commands
# print temps and fans rpms
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> sensor reading "Ambient Temp" "FAN 1 RPM" "FAN 2 RPM" "FAN 3 RPM"

# print fan info
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> sdr get "FAN 1 RPM" "FAN 2 RPM" "FAN 3 RPM"

# enable manual/static fan control
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x01 0x00

# disable manual/static fan control
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x01 0x01

# set fan speed to 0 rpm
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x02 0xff 0x00

# set fan speed to 20 %
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x02 0xff 0x14

# set fan speed to 30 %
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x02 0xff 0x1e

# set fan speed to 100 %
ipmitool -I lanplus -H <iDRAC-IP> -U <iDRAC-USER> -P <iDRAC-PASSWORD> raw 0x30 0x30 0x02 0xff 0x64
```

### dell-iDRAC ä¸ IPMIé—®é¢˜

ä¸€ã€dell æœåŠ¡å™¨å®‰è£…äº†ç¬¬ä¸‰æ–¹é…ä»¶å¦‚PCIEå¡ã€å›ºæ€ç­‰ï¼Œå°±ä¼šå¯¼è‡´é£æ‰‡è‡ªåŠ¨æ§åˆ¶åºŸæ‰ã€‚

- [Dell actually instructs users to use this feature for certain issues arising from Dell's poor integration with other hardware.](https://www.dell.com/community/PowerEdge-Hardware-General/r730xd-excessive-fan-speed/td-p/4586254)
- So, dell says to do something and takes away the ability to do it? This is a very poor business practice.

```txt
# r730xd excessive fan speed
I added a PCIe card to my r730xd. Â The fans went from 3,800 RPM to 17,000.

The Lifecycle log showed:

## _PCI3018_
_New PCI card(s) have been detected in the system. Fan speeds may have changed to add additional cooling to the cards._

The suggested solution to this is:
Â _If a lower fan speed is required, contact your service provider for the appropriate IPMI commands to reduce the default fan speed response for new PCIe cards._

I have been working with my local Dell service contact but they so far are not able to provide me with the IPMI sequence I require to not scream the fans.

FWIW, my t410 has the pair of this card (a Mellanox 40/56GB dual port card) and it has not adjusted the fans in the least. Â Mellanox describes this as a low power card. Â Whenever I remove it from the screamer, the heat sink is not even warm to the touch.

```

äºŒã€æœ¬æ¥å¯ä»¥é€šè¿‡IPMIè®¾ç½®ä¸ºæ‰‹åŠ¨æ§åˆ¶è§£å†³ï¼Œç»“æœä»–åœ¨iDRAC 3.34ç‰ˆæœ¬åç§»é™¤äº†æ”¹æ”¯æŒã€‚å¹¶åœ¨ç‰ˆæœ¬7.00.00.172 or newerè®¾ç½®æ— æ³•é™çº§ã€‚ã€‚ã€‚
- [idrac9_downgrade](https://www.reddit.com/r/homelab/comments/1byc5pv/r740xd_idrac9_downgrade/?tl=zh-hans)
- [Dell ENG is taking away fan speed control away from users ( iDrac >= 3.34.34.34)](https://www.dell.com/community/en/conversations/poweredge-hardware-general/dell-eng-is-taking-away-fan-speed-control-away-from-users-idrac-3343434/647f8593f4ccf8a8de47aa9b)
- [Custom Cooling Fan Options for Dell EMC PowerEdge Servers](https://dl.dell.com/manuals/common/customcooling_poweredge_idrac9.pdf?dgc=SM&cid=243907&lid=spr5090153920&linkId=123036317](https://dl.dell.com/manuals/common/customcooling_poweredge_idrac9.pdf?dgc=SM&cid=243907&lid=spr5090153920&linkId=123036317))
- [iDRAC9 - RAC0181 - Firmware Downgrade Failures on 14G 15G Servers](https://www.dell.com/support/kbdoc/en-us/000225924/rac0181-idrac9-firmware-downgrade-failures-on-14-15g-poweredge-servers](https://www.dell.com/support/kbdoc/en-us/000225924/rac0181-idrac9-firmware-downgrade-failures-on-14-15g-poweredge-servers))

ä¸‹æ–‡èŠ‚é€‰è‡ªä¸Šè¿°è®ºå›ã€‚
```txt
æˆ‘æ˜¯æˆ´å°”EMCçš„è§£å†³æ–¹æ¡ˆç»ç†ï¼Œè´Ÿè´£å¤„ç†è¿™ä¸ªæ”¯æŒæ¡ˆä¾‹ã€‚æˆ‘è”ç³»äº†æˆ‘ä»¬çš„å·¥ç¨‹å‡çº§éƒ¨é—¨ï¼Œè¯¢é—®äº†å…³äº

ä½¿ç”¨IPMIå‘½ä»¤ä»¥åŠåœ¨iDRAC 3.34ç‰ˆæœ¬ä¸­ç§»é™¤è¯¥åŠŸèƒ½çš„é—®é¢˜ã€‚è™½ç„¶åƒæ‚¨è¿™æ ·çš„å®¢æˆ·å¾ˆæ“…é•¿ä½¿ç”¨

è¿™äº›å‘½ä»¤ï¼Œä½†æˆ‘ä»¬æ”¶åˆ°äº†å¾ˆå¤šå…³äºå› ä½¿ç”¨ä¸å½“è€Œå¯¼è‡´ä¸¥é‡é—®é¢˜çš„å‡çº§æŠ¥å‘Šã€‚æˆ‘è¿˜è¢«å‘ŠçŸ¥ï¼Œ

è¿™äº›å‘½ä»¤æœ¬æ¥å°±ä¸åº”è¯¥æä¾›ï¼Œä½†ä¹‹å‰å·²ç»æä¾›äº†ä¸€æ®µæ—¶é—´ã€‚æˆ‘ä»¬çŸ¥é“æˆ´å°”æœ‰ä¸€äº›ç™½çš®ä¹¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨IPMIï¼Œä½†ç”±äºå®ƒå¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å·²ç»å°†å…¶åˆ é™¤ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æœªæ¥çš„ä»»ä½•ç‰ˆæœ¬ä¸­é‡æ–°æ·»åŠ ã€‚è‡³äºæ‚¨çš„æœåŠ¡å™¨é…ç½®å’Œ

åœ¨ç³»ç»Ÿä¸­å®‰è£…ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯ç¡¬ç›˜å’Œæ˜¾å¡ï¼Œè¿™äº›ç»„ä»¶æ˜¯ä¸å—æ”¯æŒçš„ï¼Œå¹¶ä¸”æ‚¨ä¹ŸçŸ¥é“ï¼Œè¿™ä¼šå¯¼è‡´é£æ‰‡é«˜é€Ÿè¿è½¬ï¼Œå› ä¸ºç³»ç»Ÿè¯•å›¾ç¡®ä¿é€‚å½“çš„æ•£çƒ­ã€‚æˆ‘ä»¬ä¸ç¡®å®šæ‚¨æ˜¯å¦‚ä½•ä½¿ç”¨è¿™å°æœåŠ¡å™¨çš„ï¼Œä½†ä½œä¸ºå»ºè®®

å¹¶ä¸”åŸºäºæ‚¨æ·»åŠ çš„è¿™äº›é¢å¤–ç»„ä»¶ï¼Œä½¿ç”¨å·¥ä½œç«™å¯èƒ½æ›´åˆé€‚ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨ã€‚

There are a couple configurations settings you can tweak.

This white paper has some adjustments you can try such as System Thermal Profile settings and Fan Offsets:

If you are on iDRAC vesion 7.00.00.172 or newer you cannot downgrade past 7.00.00.172
```

## å°è¯•å…³é—­ç¬¬ä¸‰æ–¹é…ä»¶å“åº”

- [How to disable the third-party PCIe Card default cooling response on PowerEdge 13G Servers](https://www.dell.com/support/kbdoc/en-us/000135682/how-to-disable-the-third-party-pcie-card-default-cooling-response-on-poweredge-13g-servers)
```bash
# Set Third-Party PCIe Card Default Cooling Response Logic To Disabled
ipmitool -I lanplus -H <IPADDRESS> -U <USERNAME> -P <PASSWORD> raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x01 0x00 0x00
  
# Set Third-Party PCIe Card Default Cooling Response Logic To Enabled
ipmitool -I lanplus -H <IPADDRESS> -U <USERNAME> -P <PASSWORD> raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x00 0x00 0x00 

# Get Third-Party PCIe Card Default Cooling Response Logic Status.
ipmitool -I lanplus -H <IPADDRESS> -U <USERNAME> -P <PASSWORD> raw 0x30 0xce 0x01 0x16 0x05 0x00 0x00 0x00
```

The response data will be:
```bash
16 05 00 00 00 05 00 01 00 00 (Disabled)
16 05 00 00 00 05 00 00 00 00 (Enabled)
```

ä½†æ˜¯æˆ‘çš„æ˜¯ï¼š
```bash
Unable to send RAW command (channel=0x0 netfn=0x30 lun=0x0 cmd=0xce rsp=0xc1): Invalid command
```
### è¿˜æ˜¯iDRAC7.0çš„é—®é¢˜
ä¸‹æ–‡éƒ¨åˆ†å†…å®¹æˆªå–è‡ªè¯¥é“¾æ¥ï¼š[dellè½¬é€Ÿå¼‚å¸¸](https://www.dell.com/community/zh/conversations/poweredgeæœåŠ¡å™¨/r7525é£æ‰‡è½¬é€Ÿå¼‚å¸¸/66bde9d047effa74c48587c6)ã€‚

ä½¿ç”¨äº†ipmitool & racadm é£æ‰‡è½¬é€Ÿæ²¡æœ‰ä¸‹é™ï¼Œè¿˜æ˜¯åœ¨100%ç»´æŒã€‚
```
racadm>>racadmÂ setsystem.pcieslotlfm.2.lfmmode disabledÂ ERROR: PCI3022: UnableÂ toadjust the Airflow Linear Flow per Minute (LFM) settingsÂ ofÂ the PCIe slot because the LFM settings can be adjusted onlyÂ forÂ installed cards that are identifiedÂ asÂ third party cards. racadm>>racadmÂ getsystem.PCIeSlotLFM.2.LFMMode [Key=system.Embedded.1#PCIeSlotLFM.3] LFMMode=Automatic racadm>>racadmÂ setÂ system.PCIeSlotLFM.2.LFMModeÂ 1ERROR: PCI3022: UnableÂ toÂ adjust the Airflow Linear Flow per Minute (LFM) settingsÂ ofÂ the PCIe slot because the LFM settings can be adjusted onlyÂ forÂ installed cards that are identifiedÂ asÂ third party cards. racadm>>racadmÂ setsystem.PCIeSlotLFM.2.3rdpartycard yesÂ ERROR: The specifiedÂ objectÂ isREAD ONLYÂ andÂ cannot be modified.
```

ä»¥ä¸Šæ˜¯æˆ‘å°è¯•ä½¿ç”¨å‘½ä»¤å»å…³é—­a30æ§½ä½çš„lfmè¡¥å¿ï¼Œä½†æ˜¯å®ƒè¯´è¿™å¿…é¡»æ˜¯ç¬¬ä¸‰æ–¹å¡æ‰è¡Œï¼Œä½†æ˜¯è¿™ä¸ªa30å¡å°±æ˜¯æ™®é€šçš„è‹±ä¼Ÿè¾¾å…¬ç‰ˆï¼Œå¹¶ä¸æ˜¯æˆ´å°”çš„oemç‰ˆæœ¬ï¼Œå› æ­¤æˆ‘å°è¯•æŠŠå®ƒä¿®æ”¹æˆç¬¬ä¸‰æ–¹å¡ï¼Œå‘ç°è¿™ä¸ªå€¼æ˜¯åªè¯»çš„ã€‚(è¡¥å……ï¼šæˆ‘ä½¿ç”¨äº†éå…¼å®¹æ€§åˆ—è¡¨ä¸­çš„æ˜¾å¡ï¼ŒæœåŠ¡å™¨ä¾æ—§è®¤ä¸ºè¿™ä¸æ˜¯ç¬¬ä¸‰æ–¹é…ä»¶)

æ‰€ä»¥ç›®å‰æˆ‘æƒ³è¦ä¿®æ”¹å®ƒçš„lfmè¡¥å¿å€¼ï¼Œå°±éœ€è¦æŠŠå®ƒä¿®æ”¹æˆç¬¬ä¸‰æ–¹å¡ï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹å¡æ˜¯åªè¯»çš„ï¼Œæˆ‘ç›®å‰ä¸çŸ¥é“æ€ä¹ˆå¼ºè¡Œä¿®æ”¹ã€‚ä½†æ˜¯åœ¨ä½ç‰ˆæœ¬çš„idrac9(6.00.30.00)ä¸­ä¼¼ä¹å¯ä»¥ç›´æ¥é€šè¿‡ï¼š
```
racadmÂ setsystem.pcieslotlfm.2.lfmmode disabled
```
å‘½ä»¤æ¥å…³é—­lfmè¡¥å¿ï¼Œå› ä¸ºè®¾å¤‡æ­£ç¡®çš„æŠŠç¬¬ä¸‰æ–¹é…ä»¶è¯†åˆ«å‡ºæ¥äº†ï¼Œä½†æ˜¯åœ¨idrac9(7.00.00.00)ä¸­å› ä¸ºè®¾å¤‡æ²¡æœ‰æ­£ç¡®è¯†åˆ«ç¬¬ä¸‰æ–¹é…ä»¶ï¼Œæ‰€ä»¥æ— æ³•æŒ‰ç…§æ‰€å¸Œæœ›çš„é‚£æ ·å»æ‰§è¡Œï¼Œä¼šæœ‰æŠ¥é”™ã€‚
```
racadm>>racadmÂ setsystem.pcieslotlfm.2.lfmmode disabled ERROR: PCI3022: UnableÂ toadjust the Airflow Linear FlowÂ perMinuteÂ (LFM) settingsÂ ofÂ the PCIe slot because the LFM settings can be adjustedÂ onlyÂ forÂ installed cards thatÂ areÂ identifiedÂ asÂ third party cards.
```
å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå°±ä¼šåƒæˆ‘ä»¥ä¸‹åˆ—å‡ºçš„æ–‡ç« ä¸€æ ·è¿”å›ä¸€ä¸ªæ­£ç¡®çš„å“åº”ï¼Œå¹¶ä¸”é£æ‰‡é€Ÿåº¦ä¸‹é™ï¼š[Dell R7515 ä½¿ç”¨ç¬¬ä¸‰æ–¹Pcieè®¾å¤‡åå¯¼è‡´çš„é£æ‰‡è½¬é€Ÿåé«˜](https://atsuko.org/?p=263)
æˆ‘çœŸè¯šå¸Œæœ›å¯ä»¥åœ¨è®ºå›ä¸­è·å–åˆ°å¦‚ä½•ä¿®æ­£ç¬¬ä¸‰æ–¹é…ä»¶çš„è¯†åˆ«ç»“æœæˆ–è€…å…¶ä»–æœ‰æ•ˆçš„æ–¹æ³•ä»¥æŠŠé£æ‰‡è½¬é€Ÿé™ä½åˆ°ä¸€ä¸ªæ­£å¸¸çš„èŒƒå›´ï¼Œè€Œä¸æ˜¯åœ¨æ— è´Ÿè½½ä¸”æ¸©åº¦æ­£å¸¸æ—¶è½¬é€Ÿç»´æŒ100%

## racadm

- ã€ŠDell EMC Systems Management Tools And Documentation å®‰è£…æŒ‡å—ã€‹
- [Dell EMC OpenManage DRAC Tools 9.2](https://www.dell.com/support/home/en-us/drivers/driversdetails?driverid=9dd9y)
- [Dell PowerEdge T640 é£æ‰‡å™ªéŸ³é—®é¢˜çš„è§£å†³](https://zhuanlan.zhihu.com/p/336990051)
- [dell support](https://www.dell.com/support/product-details/en-us/product/poweredge-t640/drivers)ã€ŒFZDCMW3ã€

- [T640å™ªéŸ³](https://blog.csdn.net/weixin_35727143/article/details/119591479)
```bash
# æŸ¥çœ‹æœ‰å‡ ä¸ªPCIEçš„ä¸œè¥¿ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯æœ€åä¸€ä¸ªã€‚
sudo racadm get System.PCIESlotLFM

# è®¾ç½®æ¨¡å¼ï¼Œåº”è¯¥åªæœ‰0ï¼Œ1ï¼Œ2ä¸‰ç§ï¼Œå¯¹åº”é«˜ä¸­ä½; è®¾ç½®ä¸º2åï¼Œè€³æœµç»ˆäºæ¸…é™äº†ï¼Ÿ
sudo racadm set System.PCIESlotLFM.8.LFMMode
```

æœ‰ä¸‰ç§ RACADM ä½¿ç”¨æ¨¡å¼ï¼ˆç†è§£å¥½å†åŠ¨æ‰‹ä¼šå°‘è¸©å‘ï¼‰

- Local RACADMï¼ˆåœ¨è¢«ç®¡ç†ä¸»æœºçš„ OS ä¸Šè¿è¡Œï¼Œé€šå¸¸éœ€è¦åœ¨è¯¥ä¸»æœºä¸Šå®‰è£… iDRAC Tools/OMSAï¼‰ï¼›
- Remote RACADMï¼ˆåœ¨ç®¡ç†ç«™é€šè¿‡ç½‘ç»œå¯¹ iDRAC å‘å‘½ä»¤ï¼Œå¸¸ç”¨
```bash
racadm -r <IP> -u <user> -p <pass> <cmd>ï¼‰ï¼›
```

Firmware/SSH RACADMï¼ˆç›´æ¥ SSH ç™» iDRACï¼Œè¿›å…¥ iDRAC çš„ racadm shellï¼‰ã€‚

### æ£€æŸ¥ç³»ç»Ÿè®¾ç½®
1. ç¡®è®¤ iDRAC çš„ IPã€å­ç½‘ã€ç½‘å…³ä¸ç®¡ç†å¸å·ï¼ˆé»˜è®¤ root / calvinï¼Œè‹¥å·²æ”¹åˆ™ç”¨æ”¹åå¸å·ï¼‰ã€‚
2. ç®¡ç†ç«™èƒ½è¿é€š iDRACï¼ˆç¤ºä¾‹ï¼‰ï¼š

```bash
ping -c 3 <idrac-ip>

# æˆ–æ£€æŸ¥ 443/22 ç«¯å£æ˜¯å¦å¼€æ”¾
nc -vz <idrac-ip> 443
nc -vz <idrac-ip> 22
```

ç¡®ä¿ iDRAC ä¸Šå·²å¯ç”¨ Remote RACADM/SSHï¼ˆé€šå¸¸é»˜è®¤å¯ç”¨ï¼›è‹¥æ²¡å¯å¯åœ¨ iDRAC Web UI â†’ Overview â†’ iDRAC Settings â†’ Network â†’ Services ä¸‹å¯ç”¨ Remote RACADM / SSHï¼‰ã€‚

### å®‰è£… RACADM

**Windows**

1. åˆ° Dell æ”¯æŒé¡µé¢ä¸‹è½½ â€œDell OpenManage / iDRAC Tools (åŒ…å« RACADM CLI)â€ï¼ˆä¾‹å¦‚ Windows å®‰è£…åŒ… OM-DRAC-Dell-Web-WINX64-*.exeï¼‰ã€‚ä¸‹è½½é¡µé¢ç¤ºä¾‹ã€‚
2. åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿è¡Œå®‰è£…ç¨‹åºï¼ŒæŒ‰å‘å¯¼å®Œæˆã€‚
3. å®‰è£…åæ‰“å¼€ CMD/PowerShellï¼ŒéªŒè¯ï¼š

```bash
racadm help
racadm getsysinfo
```

**Linuxï¼ˆRHEL/CentOS/Ubuntu ç­‰ï¼‰**

1. åˆ° Dell æ”¯æŒé¡µé¢ä¸‹è½½ iDRAC Tools for Linux çš„ tar.gzï¼ˆç‰ˆæœ¬æŒ‰ä½ éœ€è¦çš„ iDRAC Tools é€‰ï¼‰ã€‚
2. åœ¨ç®¡ç†ç«™è§£å‹å¹¶å®‰è£…ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```bash
# å‡è®¾æ–‡ä»¶å
iDRAC.TOOLS.LX.x.x.tar.gz
tar -zxvf iDRAC.TOOLS.LX.x.x.tar.gz
cd iDRAC_Tools/linux/rac
sudo ./install_racadm.sh
```

Debian/Ubuntu å¦‚æ— åŸç”ŸåŒ…ï¼Œæœ‰æ—¶éœ€è¦æŠŠ RPM è½¬æˆ DEBï¼ˆalienï¼‰æˆ–ä½¿ç”¨å®˜æ–¹ç»™å‡ºçš„è¯´æ˜ï¼ˆå¤šæ•° RHELç³»ç›´æ¥æ”¯æŒï¼‰ã€‚å®‰è£…åéªŒè¯ï¼š

```bash
which racadm
racadm help
racadm getsysinfo
```

ï¼ˆå®˜æ–¹å®‰è£…æµç¨‹ä¸è„šæœ¬è¯´æ˜è§åŒ…å†… readme.txt/Dell æ–‡æ¡£ï¼‰ã€‚

### è¿œç¨‹è¿æ¥ iDRAC

**1) Remote RACADMï¼ˆæœ€å¸¸ç”¨ï¼‰**

è¯­æ³•ï¼š
```bash
racadm -r <iDRAC-IP> -u <username> -p <password> <subcommand> [options]
```

ç¤ºä¾‹ï¼š
```bash
# è·å–è¯¦ç»†ç³»ç»Ÿ/iDRAC ä¿¡æ¯
racadm -r 10.0.0.5 -u root -p 'YourP@ss' getsysinfo -d

# æŸ¥è¯¢ iDRAC çš„ç½‘å£é…ç½®
racadm -r 10.0.0.5 -u root -p 'YourP@ss' getniccfg

# æŸ¥çœ‹ç¡¬ä»¶æ¸…å•ï¼ˆé•¿ï¼‰
racadm -r 10.0.0.5 -u root -p 'YourP@ss' hwinventory

# æŸ¥çœ‹ç³»ç»Ÿäº‹ä»¶æ—¥å¿—ï¼ˆSELï¼‰
racadm -r 10.0.0.5 -u root -p 'YourP@ss' getsel
```

ï¼ˆè¿œç¨‹ RACADM çš„è®¿é—®/é™åˆ¶ä¸ä½¿ç”¨è¯´æ˜è§å®˜æ–¹æ–‡æ¡£ï¼‰ã€‚

**2) Firmware RACADMï¼ˆSSH ç™»å½• iDRACï¼‰**

```bash
ssh root@<iDRAC-IP>

# ç™»å…¥åä¼šåˆ° iDRAC shellï¼Œç›´æ¥è¿è¡Œ racadm å‘½ä»¤ï¼ˆæˆ–ç›´æ¥åœ¨ ssh ä¸€è¡Œè¿è¡Œï¼‰
ssh root@<iDRAC-IP> 'racadm getsysinfo -d'
```

è¿™ä¸ªæ–¹å¼ç­‰åŒåœ¨ iDRAC å›ºä»¶å±‚ä½¿ç”¨ racadmï¼Œé€‚åˆæ— æ³•åœ¨ç®¡ç†ç«™å®‰è£…å·¥å…·æˆ–éœ€è¦åœ¨ iDRAC æœ¬åœ°æ‰§è¡Œå‘½ä»¤çš„æƒ…å†µã€‚

### å¸¸ç”¨å‘½ä»¤

 **ç³»ç»Ÿä¿¡æ¯ / ç›˜ç‚¹**
```bash
# è¯¦ç»†ç³»ç»Ÿä¿¡æ¯
racadm -r <IP> -u <user> -p <pass> getsysinfo -dÂ  Â  Â  Â  

# iDRAC/firmware ç‰ˆæœ¬ä¿¡æ¯
racadm -r <IP> -u <user> -p <pass> getversionÂ  Â  Â  Â  Â  

# å®Œæ•´ç¡¬ä»¶æ¸…å•ï¼ˆNIC, PCIe, DIMM...ï¼‰
racadm -r <IP> -u <user> -p <pass> hwinventory
#ï¼ˆhwinventory å¯ç”¨æ¥å®šä½â€œå“ªä¸ª PCIe å¡ æ²¡è¢«è¯†åˆ« / third-partyâ€ï¼‰ã€‚
```

**ç½‘ç»œè®¾ç½®**
```bash
# ç”¨é™æ€ IP è®¾ç½®ï¼ˆç®€ä¾¿å‘½ä»¤ï¼‰
racadm -r <IP> -u <user> -p <pass> setniccfg -s 192.168.1.55 255.255.255.0 192.168.1.1

# æ‰“å¼€/å…³é—­ DHCP
racadm -r <IP> -u <user> -p <pass> setniccfg -d Â  # å¼€å¯ DHCP
racadm -r <IP> -u <user> -p <pass> setniccfg -s <ip> <mask> <gw>Â  # è®¾é™æ€
ï¼ˆä¹Ÿå¯ç”¨ racadm get / racadm set æˆ– racadm config -g <group> -o <obj> <val> æ“ä½œæ›´ç»†çš„å¯¹è±¡ï¼‰ã€‚

```
**ç”µæº / é‡å¯**
```bash
racadm -r <IP> -u <user> -p <pass> serveraction powerstatus Â  # æŸ¥çœ‹ç”µæºçŠ¶æ€
racadm -r <IP> -u <user> -p <pass> serveraction powerdown Â  Â  # å…³æœº
racadm -r <IP> -u <user> -p <pass> serveraction powerup Â  Â  Â  # å¼€æœº
racadm -r <IP> -u <user> -p <pass> serveraction powercycleÂ  Â  # é‡å¯ï¼ˆcoldï¼‰
racadm -r <IP> -u <user> -p <pass> serveraction hardreset Â  Â  # å¼ºåˆ¶é‡å¯
```
ï¼ˆè¿™äº›æ˜¯å®˜æ–¹æ”¯æŒçš„ serveraction é€‰é¡¹ï¼‰ã€‚

**æ—¥å¿— / SEL**

```bash
racadm -r <IP> -u <user> -p <pass> getsel
racadm -r <IP> -u <user> -p <pass> clrsel Â  Â  Â  # æ¸… SELï¼ˆè°¨æ…ï¼‰
```
**iDRAC é‡å¯ / æ¢å¤å‡ºå‚**

```bash
# é‡å¯ iDRACï¼ˆä¸æ”¹é…ç½®ï¼‰
racadm -r <IP> -u <user> -p <pass> racreset

# æ¢å¤å‡ºå‚ï¼ˆä¼šæ¸…é™¤é…ç½®ï¼Œè°¨æ…ï¼‰
racadm -r <IP> -u <user> -p <pass> racresetcfgÂ  Â  # ä¿ç•™æŸäº›ç½‘ç»œ/ç”¨æˆ·é€‰é¡¹
racadm -r <IP> -u <user> -p <pass> racresetcfg -rc # æ¢å¤ root/calvin (å‡ºå‚)
```
ï¼ˆracresetã€racresetcfg çš„è¡Œä¸ºä¸å‚æ•°è¯·å…ˆè¯»è¯´æ˜ï¼Œæ‰§è¡Œå‰ç¡®è®¤ï¼‰ã€‚

**åˆ›å»º / ä¿®æ”¹ iDRAC ç”¨æˆ·ï¼ˆç¤ºä¾‹æŠŠ 3 å·æ§½è®¾ç½®ä¸º admin2ï¼‰**
```bash
racadm -r <IP> -u <user> -p <pass> set iDRAC.Users.3.Username admin2
racadm -r <IP> -u <user> -p <pass> set iDRAC.Users.3.Password 'P@ssw0rd'

# å¯ç”¨è¯¥è´¦å·
racadm -r <IP> -u <user> -p <pass> set iDRAC.Users.3.Enable 1

# åˆ†é…æƒé™ï¼šå»ºè®®ç”¨å®˜æ–¹æ–‡æ¡£æŸ¥æƒé™ bitmask æˆ–ç”¨ web UI è®¾ç½®
ï¼ˆé»˜è®¤ root ç´¢å¼•é€šå¸¸æ˜¯ 2ï¼›ä¿®æ”¹é»˜è®¤å¯†ç å¾ˆé‡è¦ï¼‰ã€‚
**ä¸Šä¼  SSH å…¬é’¥ï¼ˆå…å¯†ç™»å½•ï¼‰**
# æœ¬åœ°å®‰è£… racadm åï¼Œä¸Šä¼  public key æ–‡ä»¶åˆ°ç”¨æˆ· indexï¼ˆä¾‹å¦‚ index=2, key slot=1ï¼‰
racadm sshpkauth -i 2 -k 1 -f /path/to/id_rsa.pub

# æˆ–ç›´æ¥æŠŠ key æ–‡æœ¬æäº¤ï¼ˆremote racadmï¼‰
racadm -r <IP> -u <user> -p <pass> sshpkauth -i 2 -k 1 -t "<key-text>"
```

ï¼ˆiDRAC æ”¯æŒä¸ºç”¨æˆ·ä¸Šä¼ å¤šæŠŠå…¬é’¥ï¼Œç”¨äº SSH å…¬é’¥è®¤è¯ï¼‰ã€‚
```bash
# éªŒè¯è¿é€š
ping <idrac-ip>
nc -vz <idrac-ip> 443

# æµ‹è¯•è¿œç¨‹ racadm
racadm -r <IP> -u <user> -p <pass> getsysinfo -d

# æŸ¥çœ‹ä¼ æ„Ÿå™¨ä¿¡æ¯
racadm -r <IP> -u <user> -p <pass> getsensorinfo

# ç½‘å¡ä¿¡æ¯
racadm -r <IP> -u <user> -p <pass> getniccfg

# ç¡¬ä»¶ç›˜ç‚¹
racadm -r <IP> -u <user> -p <pass> hwinventory

# æŸ¥çœ‹ / æ¸… SEL
racadm -r <IP> -u <user> -p <pass> getsel
racadm -r <IP> -u <user> -p <pass> clrsel

# ç”µæºæ§åˆ¶
racadm -r <IP> -u <user> -p <pass> serveraction powerstatus
racadm -r <IP> -u <user> -p <pass> serveraction powercycle

# é‡å¯/æ¢å¤
racadm -r <IP> -u <user> -p <pass> racreset
racadm -r <IP> -u <user> -p <pass> racresetcfg -rc

# æ·»åŠ ç”¨æˆ·
racadm -r <IP> -u <user> -p <pass> set iDRAC.Users.3.Username admin2
racadm -r <IP> -u <user> -p <pass> set iDRAC.Users.3.Password 'P@ssw0rd'
```

#### racadm è®¾ç½®é£æ‰‡(è·Ÿç•Œé¢è®¾ç½®ä¸€æ ·çš„)

```bash
racadm -r <iDRAC-IP> -u root -p '<pass>' get system.thermalsettings.ThermalProfile
racadm -r <iDRAC-IP> -u root -p '<pass>' get system.thermalsettings.FanSpeedOffset

# 0=Auto, 1=Maximum performance, 2=Minimum Power
racadm -r <iDRAC-IP> -u root -p '<pass>' set system.thermalsettings.ThermalProfile 2

# FanSpeedOffset: 0=Low, 1=High, 2=Medium, 3=Max, 255=None
racadm -r <iDRAC-IP> -u root -p '<pass>' set system.thermalsettings.FanSpeedOffset 255
# æˆ–è€…è®¾ä¸º Lowï¼ˆçœ‹ä½ æœºå™¨å®é™…æ•ˆæœï¼‰
racadm -r <iDRAC-IP> -u root -p '<pass>' set system.thermalsettings.FanSpeedOffset 0

# 0=Disable, 1=Enable
racadm -r <iDRAC-IP> -u root -p '<pass>' set system.thermalsettings.ThirdPartyPCIFanResponse 0
```

### å¸¸è§é—®é¢˜

1. â€œFailed to initialize transportâ€ / racadm æ— æ³•å‘èµ·è¿æ¥ï¼šåœ¨ Linux ä¸Šå¸¸è§æ˜¯ç¼ºå°‘ OpenSSL dev åº“ï¼ˆæˆ– openssl-develï¼‰ï¼Œæˆ–ç®¡ç†ç«™ä¸Š racadm ç‰ˆæœ¬ä¸ç³»ç»Ÿåº“å†²çªï¼›æ ¹æ®é”™è¯¯å®‰è£… openssl-devel / ç›¸å…³ä¾èµ–åé‡è¯•ã€‚
2. è¿œç¨‹è¿æ¥è¢«æ‹’ç» / â€œRemote RACADM disabledâ€ï¼šæ£€æŸ¥ iDRAC Web UI çš„ Services é¡µé¢æ˜¯å¦ç¦ç”¨äº† Remote RACADMï¼›SSH ä¹Ÿéœ€å¯ç”¨ã€‚
3. æƒé™ä¸è¶³çš„é”™è¯¯ï¼šç¡®è®¤ä½ ç”¨çš„è´¦æˆ·æœ‰è¶³å¤Ÿæƒé™ï¼ˆä¾‹å¦‚æŸ¥è¯¢ SEL éœ€ç›¸åº”æƒé™ï¼Œä¿®æ”¹ iDRAC é…ç½®éœ€ Configure iDRAC æƒé™ï¼‰ã€‚
4. æŸäº›æ—§/æ–°å‘½ä»¤è¢«å¼ƒç”¨æˆ–è¡Œä¸ºéš iDRAC ç‰ˆæœ¬ä¸åŒï¼šä¾‹å¦‚ getconfig åœ¨æ–°å›ºä»¶ä¸­è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œä½¿ç”¨ racadm get/racadm set æ›¿ä»£ã€‚åŠ¡å¿…æŒ‰ä½  iDRAC ç‰ˆæœ¬çš„ RACADM CLI Guide æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆä¸åŒç‰ˆæœ¬çš„å¯¹è±¡åæˆ–é€‰é¡¹å¯èƒ½ä¸åŒï¼‰ã€‚


**æ³¨æ„ï¼š**
- ä¿®æ”¹ root/calvin é»˜è®¤å¯†ç 
- æŠŠ iDRAC æ”¾åœ¨å—æ§çš„ç®¡ç† VLAN/å­ç½‘ï¼Œæ§åˆ¶è®¿é—®æ¥æºï¼ˆé˜²ç«å¢™è§„åˆ™ï¼‰ï¼Œä¸è¦ç›´æ¥æš´éœ²åˆ°å…¬ç½‘ã€‚
- ç”¨ SSH å…¬é’¥ç™»å½•æˆ–è¯ä¹¦ç™»é™†æ›¿ä»£æ˜æ–‡å¯†ç ã€‚
- RACADMã€iDRAC å›ºä»¶å’Œç®¡ç†å·¥å…·ï¼ˆiDRAC Tools/OMSAï¼‰ä¿æŒç›¸äº’å…¼å®¹çš„ç‰ˆæœ¬ï¼Œå‡çº§å‰åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å‘½ä»¤è¡Œä¸ºï¼ˆfirmware ä¸å·¥å…·çš„ç‰ˆæœ¬å·®å¼‚ä¼šå½±å“å‘½ä»¤å¯ç”¨æ€§ï¼‰ã€‚

## openBMCï¼Ÿ

iDRACå°±æ˜¯ä»openBMCçš„åŸºç¡€ä¸Šæ”¹çš„ï¼Œåˆ°ç°åœ¨æ•…æ„ä¸å…¼å®¹â€¦â€¦

[Dell Open Server Manager (OSM) guide](https://www.dell.com/support/manuals/zh-cn/oth-t340/smog_26.0/dell-open-server-manager-osm?guid=guid-1242ec72-e69b-41c5-bfde-0729604acce0&lang=zh-cn)
> æ³¨:OSM ç°å·²åœå”®ï¼ŒDell Technologies å»ºè®®æ‰§è¡Œ OSM 3.0.2 åˆ° iDRAC10 çš„è½¬æ¢ã€‚

## å°è¯•æ‹†/æ¢â€œä¸å…¼å®¹â€PCIE
SB-DELLï¼Œè¿™æ˜æ˜¾æ•…æ„ä¸ä¿®ï¼Œè¿˜æŠŠè·¯éƒ½å µæ­»ï¼Œä½œä¸ºä¸€ä¸ªOEMï¼Œæ¯”è‹¹æœå…¼å®¹æ€§è¿˜å·®â€¦â€¦
åªèƒ½æ‹†/æ¢æ‰€è°“ä¸å…¼å®¹çš„PCIEè®¾å¤‡ï¼ˆ4090æ˜¾å¡æ‹†ä¸‹æ¥å°±å¥½äº†ï¼‰ã€‚

### dell æœåŠ¡å™¨å…¼å®¹æ€§æŸ¥è¯¢
- [poweredge-server-gpu-matrix](https://www.delltechnologies.com/asset/en-iq/products/servers/briefs-summaries/poweredge-server-gpu-matrix.pdf)
- [poweredge-t640 GPU options](https://i.dell.com/sites/csdocuments/shared-content_data-sheets_documents/en/poweredge-t640-spec-sheet.pdf): 4 x DW or 8 x SW
	- Nvidia Tesla P100, K80M, M60, M10, P40
	- AMD S7150, S7150X22
