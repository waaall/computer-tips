20210918

有个问题：就是对于现代计算机来说，中断过程切换上下文是一个怎样的过程？这派生为很多小问题，比如：PC寄存器的值，是虚拟地址吧，保存在堆栈，那页表基址寄存器是不是也要压栈？什么时候将TLB清空？（TLB,cache的操作由硬件完成）
  

到底什么是“硬件完成”？什么是操作系统完成(操作系统算法不是由硬件完成的吗？)？


**凡是一系列“操作”是由单条指令（机器码）完成的，我们就说这些操作就是硬件完成的。**

**若是一系列“操作”是由多条指令完成的，且在内核态，则我们称这是由操作系统完成的。**

**若是一系列“操作”是由多条指令完成的，且在用户态，则我们称这是由用户进程完成的。**


**形象说明一下：**

**1. 若实现该指定功能的一系列操作在CPU不变，更换操作系统不可能改变时，就是由硬件实现的（也就是这些操作的单位小于该CPU指令集中的单条指令）**

  

  

**2. 若实现该功能的一系列操作在操作系统不变时，更换不同的用户进程并不改变时，就是由操作系统完成的。（其单位大于一个指令）**

**注：**

**1. 所谓操作，即CPU将指令解码成的微操作。**

**2. 所谓内核态和用户态，本质上就是地址空间（和CPU上下文）的切换。只不过内核态这个地址空间的指令拥有更高的“指令执行权”。**